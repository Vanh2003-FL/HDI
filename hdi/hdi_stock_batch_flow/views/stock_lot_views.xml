<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Inherit Stock Lot Form View to add Batch States -->
    <record id="view_lot_form_inherit_batch_states" model="ir.ui.view">
        <field name="name">stock.lot.form.inherit.batch.states</field>
        <field name="model">stock.lot</field>
        <field name="inherit_id" ref="stock.view_production_lot_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet" position="before">
                <header>
                    <button name="action_scan" string="Scan Batch" type="object" class="oe_highlight" invisible="batch_state != 'draft'"/>
                    <button name="action_confirm" string="Confirm Placement" type="object" class="oe_highlight" invisible="batch_state != 'placed'"/>
                    <button name="action_print_batch_label" string="Print Label" type="object" icon="fa-print"/>
                    <field name="batch_state" widget="statusbar" statusbar_visible="draft,scanned,placed,confirmed"/>
                </header>
            </xpath>
            
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="receipt_type"/>
                <field name="current_location_id"/>
                <field name="suggested_location_id"/>
            </xpath>
            
            <xpath expr="//notebook" position="inside">
                <page string="Receipt Information">
                    <group>
                        <group string="Receipt Type Details">
                            <field name="work_order_export" invisible="receipt_type != 'production_export'"/>
                            <field name="invoice_no" invisible="receipt_type != 'import'"/>
                            <field name="customs_declaration_no" invisible="receipt_type != 'import'"/>
                            <field name="sap_document_no" invisible="receipt_type != 'import'"/>
                            <field name="transfer_document_no" invisible="receipt_type != 'transfer_return'"/>
                        </group>
                        <group string="QR Code">
                            <field name="qr_code" readonly="1"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Tree View with Batch States -->
    <record id="view_lot_tree_batch_states" model="ir.ui.view">
        <field name="name">stock.lot.tree.batch.states</field>
        <field name="model">stock.lot</field>
        <field name="arch" type="xml">
            <tree string="Batches/Lots" decoration-info="batch_state == 'scanned'" decoration-success="batch_state == 'confirmed'">
                <field name="name"/>
                <field name="product_id"/>
                <field name="receipt_type"/>
                <field name="current_location_id"/>
                <field name="batch_state" widget="badge"/>
            </tree>
        </field>
    </record>

    <!-- Action for Batch Management -->
    <record id="action_stock_lot_batch_management" model="ir.actions.act_window">
        <field name="name">Batch Management</field>
        <field name="res_model">stock.lot</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_lot_tree_batch_states"/>
        <field name="context">{'search_default_product_id': [active_id], 'default_product_id': active_id}</field>
    </record>

    <!-- Menu -->
    <menuitem id="menu_batch_management"
        name="Batch Status"
        parent="menu_stock_batch_flow_root"
        action="action_stock_lot_batch_management"
        sequence="30"/>
</odoo>
