<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- WMS Dashboard View -->
    <record id="view_wms_dashboard_kanban" model="ir.ui.view">
        <field name="name">wms.dashboard.kanban</field>
        <field name="model">wms.dashboard</field>
        <field name="arch" type="xml">
            <kanban class="o_wms_dashboard" create="0" edit="0" delete="0">
                <field name="name"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click o_wms_dashboard_kanban">
                            <div class="o_kanban_record_top">
                                <h3><field name="name"/></h3>
                            </div>
                            <div class="o_wms_dashboard_content">
                                <!-- Dashboard content will be loaded via JavaScript -->
                                <div class="wms_dashboard_container">
                                    <!-- Warehouse Selector -->
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label>Select Warehouse:</label>
                                            <select id="warehouse_selector" class="form-control">
                                                <option value="">Loading...</option>
                                            </select>
                                        </div>
                                        <div class="col-md-8 text-end">
                                            <button class="btn btn-primary" id="refresh_dashboard">
                                                <i class="fa fa-refresh"/> Refresh
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- KPI Cards Row 1 -->
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <div class="card bg-primary text-white">
                                                <div class="card-body">
                                                    <h5>Total Stock</h5>
                                                    <h2 id="total_stock">-</h2>
                                                    <p id="product_count" class="mb-0">- products</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-success text-white">
                                                <div class="card-body">
                                                    <h5>Available</h5>
                                                    <h2 id="available_stock">-</h2>
                                                    <p id="stock_value" class="mb-0">Value: -</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-warning text-white">
                                                <div class="card-body">
                                                    <h5>Reserved</h5>
                                                    <h2 id="reserved_stock">-</h2>
                                                    <p class="mb-0">Allocated</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-info text-white">
                                                <div class="card-body">
                                                    <h5>Capacity</h5>
                                                    <h2 id="capacity_percent">-%</h2>
                                                    <p id="capacity_text" class="mb-0">-</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Operations Row -->
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6>Receipts</h6>
                                                    <p class="mb-1">Pending: <span id="receipts_pending" class="badge bg-warning">-</span></p>
                                                    <p class="mb-0">Today: <span id="receipts_today">-</span></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6>Deliveries</h6>
                                                    <p class="mb-1">Pending: <span id="deliveries_pending" class="badge bg-warning">-</span></p>
                                                    <p class="mb-0">Today: <span id="deliveries_today">-</span></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6>Transfers</h6>
                                                    <p class="mb-1">Pending: <span id="transfers_pending" class="badge bg-info">-</span></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6>Adjustments</h6>
                                                    <p class="mb-1">Pending: <span id="adjustments_pending" class="badge bg-secondary">-</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Charts and Tables Row -->
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>Movement Trends (Last 7 Days)</h5>
                                                </div>
                                                <div class="card-body">
                                                    <canvas id="movement_chart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>Zone Capacity</h5>
                                                </div>
                                                <div class="card-body">
                                                    <canvas id="capacity_chart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Alerts and Top Products Row -->
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>Alerts <span id="alert_count" class="badge bg-danger">0</span></h5>
                                                </div>
                                                <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                                                    <div id="alerts_list">
                                                        <p class="text-muted">No alerts</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>Top 10 Products (Last 30 Days)</h5>
                                                </div>
                                                <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                                                    <table class="table table-sm" id="top_products_table">
                                                        <thead>
                                                            <tr>
                                                                <th>Product</th>
                                                                <th class="text-end">Movements</th>
                                                                <th class="text-end">Qty</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td colspan="3" class="text-muted">Loading...</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Performance Metrics -->
                                    <div class="row mt-3">
                                        <div class="col-md-12">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>Performance Metrics (This Month)</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <p class="mb-1"><strong>Avg Receipt Time</strong></p>
                                                            <h4 id="avg_receipt_time">-</h4>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <p class="mb-1"><strong>Avg Delivery Time</strong></p>
                                                            <h4 id="avg_delivery_time">-</h4>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <p class="mb-1"><strong>Fulfillment Rate</strong></p>
                                                            <h4 id="fulfillment_rate">-%</h4>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <p class="mb-1"><strong>Inventory Accuracy</strong></p>
                                                            <h4 id="inventory_accuracy">-%</h4>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Dashboard Action -->
    <record id="action_wms_dashboard" model="ir.actions.act_window">
        <field name="name">WMS Dashboard</field>
        <field name="res_model">wms.dashboard</field>
        <field name="view_mode">kanban</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                WMS Dashboard
            </p>
            <p>
                Real-time warehouse management dashboard with KPIs and charts.
            </p>
        </field>
    </record>

</odoo>
