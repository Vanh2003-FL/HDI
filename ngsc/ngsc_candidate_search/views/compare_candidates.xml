<?xml version="1.0" encoding="UTF-8"?>

<odoo>

    <template id="layout" name="Report layout">&lt;!DOCTYPE html&gt;
        <html t-att-lang="lang and lang.replace('_', '-')"
              t-att-data-report-margin-top="data_report_margin_top"
              t-att-data-report-header-spacing="data_report_header_spacing"
              t-att-data-report-dpi="data_report_dpi"
              t-att-data-report-landscape="data_report_landscape"
              t-att-web-base-url="web_base_url">
            <head>
                <meta charset="utf-8"/>
                <meta name="viewport" content="initial-scale=1"/>
                <title><t t-esc="title or 'Odoo Page'"/></title>
                <!-- Tải tài nguyên backend thay vì report -->
                <t t-call-assets="web.assets_backend" t-js="false"/>
                <script>
                    function onExportExcel() {
                        var activeIds = new URLSearchParams(window.location.search).get('active_ids');
                        var candidateSearchId = new URLSearchParams(window.location.search).get('candidate_search_id');

                        // Tạo URL với query parameters
                        var url = '/candidate/export_excel';
                        var params = new URLSearchParams();
                        if (activeIds) {
                            params.append('active_ids', activeIds);
                        }
                        if (candidateSearchId) {
                            params.append('candidate_search_id', candidateSearchId);
                        }
                        url += '?' + params.toString();

                        fetch(url, {
                            method: 'GET'
                        })
                        .then(response => response.blob())
                        .then(blob => {
                            var link = document.createElement('a');
                            link.href = window.URL.createObjectURL(blob);
                            link.download = 'So_sanh_nhan_su.xlsx';
                            link.click();
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Có lỗi xảy ra khi xuất Excel!');
                        });
                    }
                </script>
            </head>
            <body t-att-class="'container' if not full_width else 'container-fluid'" id="body">
                <div id="wrapwrap">
                    <main>
                        <t t-out="0"/>
                    </main>
                </div>
            </body>
        </html>
    </template>


    <template id="compare_candidates">
        <t t-call="ngsc_candidate_search.layout">
            <div class="compare-body">
                <div class="pt-3 pb-3">
                    <button class="btn btn-secondary" id="btnPrint" onclick="onExportExcel()">
                        <svg class="mr-2"  fill="#000000" height="16px" width="16px" version="1.1" id="Layer_1" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
                            <g id="Printer">
                                <path d="M57.7881012,14.03125H52.5v-8.0625c0-2.2091999-1.7909012-4-4-4h-33c-2.2091999,0-4,1.7908001-4,4v8.0625H6.2119002   C2.7871001,14.03125,0,16.8183498,0,20.2431507V46.513649c0,3.4248009,2.7871001,6.2119026,6.2119002,6.2119026h2.3798995   c0.5527,0,1-0.4472008,1-1c0-0.5527-0.4473-1-1-1H6.2119002C3.8896,50.7255516,2,48.8359489,2,46.513649V20.2431507   c0-2.3223,1.8896-4.2119007,4.2119002-4.2119007h51.5762024C60.1102982,16.03125,62,17.9208508,62,20.2431507V46.513649   c0,2.3223-1.8897018,4.2119026-4.2118988,4.2119026H56c-0.5527992,0-1,0.4473-1,1c0,0.5527992,0.4472008,1,1,1h1.7881012   C61.2128983,52.7255516,64,49.9384499,64,46.513649V20.2431507C64,16.8183498,61.2128983,14.03125,57.7881012,14.03125z    M13.5,5.96875c0-1.1027999,0.8971996-2,2-2h33c1.1027985,0,2,0.8972001,2,2v8h-37V5.96875z"/>
                                <path d="M44,45.0322495H20c-0.5517998,0-0.9990005,0.4472008-0.9990005,0.9990005S19.4482002,47.0302505,20,47.0302505h24   c0.5517006,0,0.9990005-0.4472008,0.9990005-0.9990005S44.5517006,45.0322495,44,45.0322495z"/>
                                <path d="M44,52.0322495H20c-0.5517998,0-0.9990005,0.4472008-0.9990005,0.9990005S19.4482002,54.0302505,20,54.0302505h24   c0.5517006,0,0.9990005-0.4472008,0.9990005-0.9990005S44.5517006,52.0322495,44,52.0322495z"/>
                                <circle cx="7.9590998" cy="21.8405495" r="2"/>
                                <circle cx="14.2856998" cy="21.8405495" r="2"/>
                                <circle cx="20.6121998" cy="21.8405495" r="2"/>
                                <path d="M11,62.03125h42v-26H11V62.03125z M13.4036999,38.4349518h37.1925964v21.1925964H13.4036999V38.4349518z"/>
                            </g>
                        </svg>
                        Xuất excel
                    </button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th />
                            <t t-foreach="records" t-as="emp">
                                <th>
                                    <div class="d-flex flex-column align-items-center py-2 px-3">
                                        <span><t t-esc="emp['name']"/> - <t t-esc="emp['barcode']"/></span>
                                        <span><t t-esc="emp['job_title']"/></span>
                                    </div>
                                </th>
                            </t>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td t-att-colspan="len(records) + 1" class="table-headline">Thông tin nhân sự</td>
                        </tr>
                        <tr>
                            <td class="pl-4">Khu vực</td>
                            <t t-foreach="records" t-as="emp">
                                <td class="text-center">
                                    <t t-esc="emp['area_name']"/>
                                </td>
                            </t>
                        </tr>
                        <tr>
                            <td class="pl-4">Khối</td>
                            <t t-foreach="records" t-as="emp">
                                <td class="text-center">
                                    <t t-esc="emp['block_name']"/>
                                </td>
                            </t>
                        </tr>
                        <tr>
                            <td class="pl-4">Trung tâm/Ban</td>
                            <t t-foreach="records" t-as="emp">
                                <td class="text-center">
                                    <t t-esc="emp['department']"/>
                                </td>
                            </t>
                        </tr>
                        <tr>
                            <td class="pl-4">Phòng</td>
                            <t t-foreach="records" t-as="emp">
                                <td class="text-center">
                                    <t t-esc="emp['department_name']"/>
                                </td>
                            </t>
                        </tr>
                         <tr>
                            <td class="pl-4">Email</td>
                            <t t-foreach="records" t-as="emp">
                                <td class="text-center">
                                    <t t-esc="emp['email']"/>
                                </td>
                            </t>
                        </tr>

                        <tr>
                            <td t-att-colspan="len(records) + 1" class="table-headline">Thông tin kỹ năng</td>
                        </tr>

                        <t t-foreach="skill_matrix" t-as="row">
                            <tr>
                                <t t-foreach="row" t-as="col">
                                    <t t-if="col_index == 0">
                                        <t t-if="row[0] == 1">
                                            <td class="pl-4 table-headline-2" style="color: red;"><t t-esc="row[1].name"/></td>
                                        </t>
                                        <t t-if="row[0] == 0">
                                            <td class="pl-4 table-headline-2"><t t-esc="row[1].name"/></td>
                                        </t>
                                    </t>
                                    <t t-if="col_index > 1">
                                        <t t-if="col">
                                            <td class="text-center table-headline-2"><t t-esc="col.emp_skill_id.current_level_id.name"/></td>
                                        </t>
                                        <t t-else=""><td/></t>
                                    </t>
                                </t>
                            </tr>
                            <tr>
                                <t t-foreach="row" t-as="col">
                                    <t t-if="col_index == 0">
                                        <td class="pl-4">Trọng số</td>
                                    </t>
                                    <t t-if="col_index > 1">
                                        <t t-if="col">
                                            <td class="text-center">
                                                <t t-if="col.score > 0">
                                                    <t t-esc="col.score"/>%
                                                </t>
                                            </td>
                                        </t>
                                        <t t-else=""><td/></t>
                                    </t>
                                </t>
                            </tr>
                        </t>
                    </tbody>

                </table>
            </div>
        </t>
    </template>


</odoo>