<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Tree View mặc định -->
    <record id="ngsc_innovation_idea_tree" model="ir.ui.view">
        <field name="name">ngsc_innovation_idea_view_tree</field>
        <field name="model">ngsc.innovation.idea</field>
        <field name="arch" type="xml">
            <list>
                <field name="idea_name"/>
                <field name="sender_id"/>
                <field name="sender_email"/>
                <field name="sender_block_id"/>
                <field name="sender_department_id"/>
                <field name="sender_en_department_id"/>
                <field name="send_type"/>
                <field name="sender_phone"/>
                <field name="impact_names_csv"/>
                <field name="field_type_id"/>
                <field name="current_status_id"/>
                <field name="state"/>
                <field name="member_names_csv" optional="hide"/>
                <field name="other" optional="hide"/>
                <field name="description_text" optional="hide"/>
                <field name="reject_reason" optional="hide"/>
            </list>
        </field>
    </record>

    <!-- Tree View Truyền thông -->
    <record id="ngsc_innovation_idea_tree_truyen_thong" model="ir.ui.view">
        <field name="name">ngsc_innovation_idea_view_tree_truyen_thong</field>
        <field name="model">ngsc.innovation.idea</field>
        <field name="arch" type="xml">
            <list create="false" edit="false" delete="false">
                <field name="idea_name"/>
                <field name="sender_id"/>
                <field name="sender_email"/>
                <field name="sender_block_id"/>
                <field name="sender_department_id"/>
                <field name="sender_en_department_id"/>
                <field name="send_type"/>
                <field name="sender_phone"/>
                <field name="impact_type_ids"/>
                <field name="field_type_id"/>
                <field name="current_status_id"/>
                <field name="state"/>
            </list>
        </field>
    </record>

    <!-- Tree View Hội đồng -->
    <record id="ngsc_innovation_idea_tree_hoi_dong" model="ir.ui.view">
        <field name="name">ngsc_innovation_idea_view_tree_hoi_dong</field>
        <field name="model">ngsc.innovation.idea</field>
        <field name="arch" type="xml">
            <list create="false" edit="false" delete="false">
                <field name="idea_name"/>
                <field name="sender_id"/>
                <field name="sender_email"/>
                <field name="sender_block_id"/>
                <field name="sender_department_id"/>
                <field name="sender_en_department_id"/>
                <field name="send_type"/>
                <field name="sender_phone"/>
                <field name="impact_type_ids"/>
                <field name="field_type_id"/>
                <field name="current_status_id"/>
                <field name="state"/>
            </list>
        </field>
    </record>

    <!-- Form View mặc định -->
    <record id="ngsc_innovation_idea_form" model="ir.ui.view">
        <field name="name">ngsc_innovation_idea_view_form</field>
        <field name="model">ngsc.innovation.idea</field>
        <field name="arch" type="xml">
            <form string="Ý tưởng sáng tạo" show_edit="is_editable == True">
                <header>
                    <field name="is_editable" invisible="1"/>
                    <field name="is_submit_user" invisible="1"/>
                    <button name="action_submit" string="Gửi duyệt"
                            type="object"
                            attrs="{'invisible': ['|', ('state','!=','new'),('is_submit_user','=',False)]}"
                            class="btn-primary"/>
                    <button name="action_approve" string="Duyệt"
                            type="object"
                            groups="ngsc_innovation.group_internal_communication"
                            attrs="{'invisible':[('state','!=','submitted')]}"
                            class="btn-primary"/>
                    <button name="%(ngsc_innovation.action_ngsc_innovation_reject_wizard)d"
                            string="Từ chối"
                            type="action"
                            groups="ngsc_innovation.group_internal_communication"
                            attrs="{'invisible':[('state','!=','submitted')]}"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <group string="Tên ý tưởng">
                        <field name="idea_name" nolabel="1" placeholder="Nhập tiêu đề ý tưởng" class="oe_title"
                               attrs="{'readonly': ['|', ('is_submit_user','=',False), ('state','!=','new')]}"/>
                    </group>

                    <group>
                        <group>
                            <field name="sender_id" readonly="1"/>
                            <field name="sender_email"/>
                            <field name="sender_phone"/>
                            <field name="sender_block_id"/>
                            <field name="sender_department_id"/>
                            <field name="sender_en_department_id"/>
                            <field name="send_type"
                                   attrs="{'readonly': ['|', ('is_submit_user','=',False), ('state','!=','new')]}"/>
                            <field name="member_ids" widget="many2many_tags" options="{'no_create': True}"
                                   attrs="{'invisible':[('send_type','=','individual')], 'readonly':['|',('is_submit_user','=',False),('state','!=','new')]}"/>
                        </group>
                        <group>
                            <field name="impact_type_ids" widget="many2many_tags"
                                   options="{'no_create': True}"
                                   attrs="{'readonly': ['|', ('is_submit_user','=',False), ('state','!=','new')]}"/>

                            <field name="field_type_id"
                                   attrs="{'readonly': ['|', ('is_submit_user','=',False), ('state','!=','new')]}"/>
                            <field name="current_status_id"
                                   attrs="{'readonly': ['|', ('is_submit_user','=',False), ('state','!=','new')]}"/>
                            <field name="other"
                                   attrs="{'readonly': ['|', ('is_submit_user','=',False), ('state','!=','new')]}"/>
                        </group>
                    </group>

                    <group>
                        <field name="reject_reason"
                               attrs="{'invisible': [('state', '!=', 'rejected')]}"
                               readonly="1"/>
                    </group>

                    <group string="Mô tả sáng kiến">
                        <field name="description" nolabel="1" widget="html"
                               attrs="{'readonly':['|',('is_submit_user','=',False),('state','!=','new')]}"/>
                    </group>

                    <notebook>
                        <page string="Tệp đính kèm">
                            <field name="attachment_ids" context="{'default_idea_id': active_id}"
                                   attrs="{'readonly':['|',('is_submit_user','=',False),('state','!=','new')]}">
                                <list editable="bottom">
                                    <field name="name"/>
                                    <field name="datas_fname" invisible="1"/>
                                    <field name="datas" filename="datas_fname" widget="binary"/>
                                </list>
                                <form>
                                    <group>
                                        <field name="name"/>
                                        <field name="datas_fname" invisible="1"/>
                                        <field name="datas" filename="datas_fname" widget="binary"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Form View Truyền thông -->
    <record id="ngsc_innovation_idea_form_truyen_thong" model="ir.ui.view">
        <field name="name">ngsc_innovation_idea_view_form_truyen_thong</field>
        <field name="model">ngsc.innovation.idea</field>
        <field name="arch" type="xml">
            <form string="Ý tưởng sáng tạo" create="false" edit="false" delete="false">
                <header>
                    <button name="action_final_approve"
                            type="object"
                            string="Duyệt"
                            class="btn-primary"
                            attrs="{'invisible': [('state', '!=', 'check_point')]}"
                            confirm="Bạn có chắc chắn muốn duyệt ý tưởng này?"/>

                    <button name="action_final_reject"
                            type="object"
                            string="Từ chối"
                            class="btn-secondary"
                            attrs="{'invisible': [('state', '!=', 'check_point')]}"
                            confirm="Bạn có chắc chắn muốn từ chối ý tưởng này?"/>

                    <button name="action_open_ttnb_scoring_management"
                            type="object"
                            string="Chấm điểm thay"
                            class="btn-info"
                            attrs="{'invisible': [('state', 'not in', ['approved', 'check_point'])]}"
                            icon="fa-users"/>

                    <button name="action_export_evaluation_excel"
                            type="object"
                            string="Xuất điểm"
                            class="oe_highlight"
                            attrs="{'invisible': [('state', 'not in', ['check_point', 'accepted', 'rejected'])]}"
                            icon="fa-file-excel-o"/>

                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <group string="Tên ý tưởng">
                        <field name="idea_name" nolabel="1" readonly="1" class="oe_title"/>
                    </group>

                    <group>
                        <group>
                            <field name="sender_id"/>
                            <field name="sender_email"/>
                            <field name="sender_phone"/>
                            <field name="sender_block_id"/>
                            <field name="sender_department_id"/>
                            <field name="sender_en_department_id"/>
                            <field name="send_type" readonly="1"/>
                            <field name="member_ids" widget="many2many_tags" readonly="1"
                                   attrs="{'invisible':[('send_type','=','individual')]}"/>
                        </group>
                        <group>
                            <field name="impact_type_ids" readonly="1"/>
                            <field name="field_type_id" readonly="1"/>
                            <field name="current_status_id"/>
                            <field name="other" readonly="1"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Mô tả sáng kiến">
                            <field name="description" nolabel="1" widget="html" readonly="1"/>
                        </page>

                        <page string="Tệp đính kèm">
                            <field name="attachment_ids" readonly="1">
                                <list>
                                    <field name="name"/>
                                    <field name="datas_fname"/>
                                    <field name="datas" filename="datas_fname" widget="binary"/>
                                </list>
                            </field>
                        </page>

                        <page string="Điểm trung bình">
                            <field name="scoring_ids" nolabel="1" readonly="1">
                                <list create="false" edit="false" delete="false" decoration-bf="1">
                                    <field name="criteria_id" string="Tiêu chí"/>
                                    <field name="average_score" string="Số điểm" sum="Total"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Form View Hội đồng -->
    <record id="ngsc_innovation_idea_form_hoi_dong" model="ir.ui.view">
        <field name="name">ngsc_innovation_idea_view_form_hoi_dong</field>
        <field name="model">ngsc.innovation.idea</field>
        <field name="arch" type="xml">
            <form string="Đánh giá ý tưởng" create="false" edit="false" delete="false">
                <header>
                    <field name="scoring_status" invisible="1"/>
                    <field name="has_locked_scores" invisible="1"/>

                    <button name="action_score_idea"
                            string="Chấm điểm"
                            type="object"
                            groups="ngsc_innovation.group_evaluation_board"
                            attrs="{'invisible': ['|', '|',
                ('state', '!=', 'approved'),
                ('scoring_status', '=', 'all_locked'),
                ('has_locked_scores', '=', True)]}"
                            class="btn-primary"/>

                    <button name="action_lock_scores"
                            string="Chốt điểm"
                            type="object"
                            groups="ngsc_innovation.group_evaluation_board"
                            attrs="{'invisible': ['|', '|',
            ('state', '!=', 'approved'),
            ('scoring_status', '=', 'all_locked'),
            ('has_locked_scores', '=', True)]}"
                            class="btn-primary"
                            confirm="Bạn chắc chắn muốn chốt điểm cho ý tưởng này?"/>

                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <group string="Tên ý tưởng">
                        <field name="idea_name" nolabel="1" readonly="1" class="oe_title"/>
                    </group>

                    <group>
                        <group>
                            <field name="sender_id"/>
                            <field name="sender_email"/>
                            <field name="sender_phone"/>
                            <field name="sender_block_id"/>
                            <field name="sender_department_id"/>
                            <field name="sender_en_department_id"/>
                            <field name="send_type" readonly="1"/>
                            <field name="member_ids" widget="many2many_tags" readonly="1"
                                   attrs="{'invisible':[('send_type','=','individual')]}"/>
                        </group>
                        <group>
                            <field name="impact_type_ids" readonly="1"/>
                            <field name="field_type_id" readonly="1"/>
                            <field name="current_status_id"/>
                            <field name="other" readonly="1"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Mô tả sáng kiến">
                            <field name="description" nolabel="1" widget="html" readonly="1"/>
                        </page>
                        <page string="Tệp đính kèm">
                            <field name="attachment_ids" readonly="1">
                                <list>
                                    <field name="name"/>
                                    <field name="datas_fname"/>
                                    <field name="datas" filename="datas_fname" widget="binary"/>
                                </list>
                            </field>
                        </page>

                        <page string="Chấm điểm">
                            <field name="latest_scoring_ids" readonly="1">
                                <list>
                                    <field name="criteria_id" string="Tiêu chí"/>
                                    <field name="score" string="Số điểm" sum="Tổng điểm"/>
                                </list>
                            </field>
                        </page>

                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_ngsc_innovation_idea" model="ir.actions.act_window">
        <field name="name">Ý tưởng sáng tạo</field>
        <field name="res_model">ngsc.innovation.idea</field>
        <field name="view_mode">tree,form</field>
        <field name="views" eval="[
            (ref('ngsc_innovation_idea_tree'), 'list'),
            (ref('ngsc_innovation_idea_form'), 'form')
        ]"/>
    </record>

    <record id="action_ngsc_innovation_idea_truyen_thong" model="ir.actions.act_window">
        <field name="name">Tất cả ý tưởng</field>
        <field name="res_model">ngsc.innovation.idea</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">
            ['|', '|', '|',
            ('state', '=', 'approved'),
            ('state', '=', 'accepted'),
            ('state', '=', 'check_point'),
            '&amp;',
            ('state', '=', 'rejected'),
            ('rejection_stage', '=', 'after_evaluation')
            ]
        </field>
        <field name="context">{'form_view_ref':
            'ngsc_innovation.ngsc_innovation_idea_form_truyen_thong'}
        </field>
        <field name="views" eval="[
        (ref('ngsc_innovation.ngsc_innovation_idea_tree_truyen_thong'), 'list'),
        (ref('ngsc_innovation.ngsc_innovation_idea_form_truyen_thong'), 'form')
    ]"/>
    </record>

    <record id="action_ngsc_innovation_idea_hoi_dong_danh_gia" model="ir.actions.act_window">
        <field name="name">Tất cả ý tưởng</field>
        <field name="res_model">ngsc.innovation.idea</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">['|',
            ('state', 'in', ['approved', 'check_point', 'accepted']),
            '&amp;', ('state', '=', 'rejected'),
            ('rejection_stage', '=', 'after_evaluation')
            ]
        </field>
        <field name="context">{'form_view_ref':
            'ngsc_innovation.ngsc_innovation_idea_form_hoi_dong'}
        </field>
        <field name="views" eval="[
    (ref('ngsc_innovation.ngsc_innovation_idea_tree_hoi_dong'), 'list'),
    (ref('ngsc_innovation.ngsc_innovation_idea_form_hoi_dong'), 'form')
]"/>
    </record>
</odoo>
