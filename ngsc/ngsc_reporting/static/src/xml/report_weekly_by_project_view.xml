<?xml version="1.0" encoding="UTF-8" ?>
<templates id="template" xml:space="preserve">
    <t t-name="ReportWeeklyByProject">
        <div class="oh_dashboards">
            <div class="container-fluid my-5 o_report_weekly_by_project"/>
        </div>
    </t>
    <t t-name="LoginUser">
        <section>
            <div class="row">
                <div class="col-sm-12 mb-4">
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-8">
                            <h2 class="section-header">Báo cáo tuần theo dự án</h2>
                        </div>
                    </div>
                    <hr/>
                </div>
            </div>
        </section>
    </t>
    <t t-name="FilterSection">
        <section>
            <div class="form-group row">
                <div class="col-6 d-flex flex-column" style="gap: 0.5rem">
                    <span>Chọn dự án</span>
<!--                    <select class="form-control" id="project_picker">-->
<!--                    </select>-->
                    <select id="project_picker" class="form-select form-select-sm select2-container select2"></select>
                </div>
                <div class="col-3 d-flex flex-column" style="gap: 0.5rem">
                    <span>Ngày bắt đầu báo cáo</span>
                    <input class="form-control" type="date"  id="start_date_picker"/>
                </div>
                <div class="col-3 d-flex flex-column" style="gap: 0.5rem">
                    <span>Ngày báo cáo</span>
                    <input class="form-control" type="date"  id="date_picker"/>
                </div>
            </div>
        </section>
    </t>
    <t t-name="ProjectInfo">
        <div class="chart-container card-shadow project-info">
            <h3 class="h5">1. Thông tin dự án</h3>
            <hr/>
            <div class="table-responsive">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>Mã dự án</th>
                            <th>Tên dự án</th>
                            <th>Trung tâm</th>
                            <th>Quản lý dự án</th>
                            <th>Loại dự án</th>
                            <th>Ngày bắt đầu</th>
                            <th>Ngày kết thúc</th>
                            <th>Ngày báo cáo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><t t-esc="widget.detail.en_code"/></td>
                            <td><t t-esc="widget.detail.name"/></td>
                            <td><t t-esc="widget.detail.department"/></td>
                            <td><t t-esc="widget.detail.manager"/></td>
                            <td><t t-esc="widget.detail.type"/></td>
                            <td><t t-esc="widget.detail.date_start"/></td>
                            <td><t t-esc="widget.detail.date_end"/></td>
                            <td><t t-esc="widget.detail.dateReport"/></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </t>
    <t t-name="CumulativeIndex">
        <div class="chart-container card-shadow cumulative-index">
            <h3 class="h5">2. Chỉ tiêu (Luỹ kế)</h3>
            <hr/>
            <div class="table-responsive">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>KDA</th>
                            <th>TDA WBS</th>
                            <th>SLA phản hồi</th>
                            <th>SLA xử lý</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><t t-esc="widget.cumulativeIndex.kda"/>%</td>
                            <td><t t-esc="widget.cumulativeIndex.tda"/>%</td>
                            <td><t t-esc="widget.cumulativeIndex.sla_response"/>%</td>
                            <td><t t-esc="widget.cumulativeIndex.sla_process"/>%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </t>
    <t t-name="TasksInWeek">
        <div class="chart-container card-shadow tasks-in-week">
            <h3 class="h5">3. Công việc trong tuần</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Gói việc</th>
                            <th>Trạng thái</th>
                            <th>% Hoàn thành thực tế</th>
                            <th>Ngày kết thúc kế hoạch</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.tasksInWeek and widget.tasksInWeek.length">
                            <t t-foreach="widget.tasksInWeek" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase_name']" /></td>
                                    <td><t t-esc="o['name']" /></td>
                                    <td><t t-esc="o['task_type_name']" /></td>
                                    <td><t t-esc="widget.formatPercent(o['actual_percent_completed'])"/></td>
                                    <td><t t-esc="o['date_deadline']" /></td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="5" class="text-center">Không có công việc trong tuần</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>

    <t t-name="TasksNotCompleted">
        <div class="chart-container card-shadow tasks-not-completed">
            <h3 class="h5">4. Công việc chưa hoàn thành</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Gói việc</th>
                            <th>% Hoàn thành thực tế</th>
                            <th>Ngày kết thúc kế hoạch</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.tasksNotCompleted and widget.tasksNotCompleted.length">
                            <t t-foreach="widget.tasksNotCompleted" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase_name']" /></td>
                                    <td><t t-esc="o['name']" /></td>
                                    <td><t t-esc="widget.formatPercent(o['actual_percent_completed'])"/></td>
                                    <td><t t-esc="o['date_deadline']" /></td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="4" class="text-center">Không có công việc chưa hoàn thành</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>

    <t t-name="TasksNextWeek">
        <div class="chart-container card-shadow tasks-next-week">
            <h3 class="h5">5. Công việc tuần kế tiếp</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Gói việc</th>
                            <th>% Hoàn thành thực tế</th>
                            <th>Ngày kết thúc kế hoạch</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.tasksNextWeek and widget.tasksNextWeek.length">
                            <t t-foreach="widget.tasksNextWeek" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase_name']" /></td>
                                    <td><t t-esc="o['name']" /></td>
                                    <td><t t-esc="widget.formatPercent(o['actual_percent_completed'])"/></td>
                                    <td><t t-esc="o['date_deadline']" /></td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="4" class="text-center">Không có công việc tuần kế tiếp</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>

    <t t-name="DocsCompleteInWeek">
        <div class="chart-container card-shadow docs-complete-in-week">
            <h3 class="h5">6. Sản phẩm bàn giao trong tuần</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Tên sản phẩm bàn giao</th>
                            <th>Ngày hoàn thành dự kiến</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.docsCompleteInWeek and widget.docsCompleteInWeek.length">
                            <t t-foreach="widget.docsCompleteInWeek" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase_type']" /></td>
                                    <td><t t-esc="o['name']" /></td>
                                    <td><t t-esc="o['handover_date']"/></td>
                                    <td><t t-esc="widget.convertDocState(o['state'])" /></td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="4" class="text-center">Không có sản phẩm bàn giao trong tuần</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>

    <t t-name="DocsPending">
        <div class="chart-container card-shadow docs-pending">
            <h3 class="h5">7. Sản phẩm đến hạn nhưng chưa bàn giao</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Tên sản phẩm bàn giao</th>
                            <th>Ngày hoàn thành dự kiến</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.docsPending and widget.docsPending.length">
                            <t t-foreach="widget.docsPending" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase_type']" /></td>
                                    <td><t t-esc="o['name']" /></td>
                                    <td><t t-esc="o['handover_date']"/></td>
                                    <td><t t-esc="widget.convertDocState(o['state'])" /></td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="4" class="text-center">Không có sản phẩm chưa bàn giao</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>

    <t t-name="DocsNextWeek">
        <div class="chart-container card-shadow docs-next-week">
            <h3 class="h5">8. Sản phẩm bàn giao tuần kế tiếp</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Tên sản phẩm bàn giao</th>
                            <th>Ngày hoàn thành dự kiến</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.docsNextWeek and widget.docsNextWeek.length">
                            <t t-foreach="widget.docsNextWeek" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase_type']" /></td>
                                    <td><t t-esc="o['name']" /></td>
                                    <td><t t-esc="o['handover_date']"/></td>
                                    <td><t t-esc="widget.convertDocState(o['state'])" /></td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="4" class="text-center">Không có sản phẩm bàn giao tuần kế tiếp</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>

    <t t-name="ProjectRisks">
        <div class="chart-container card-shadow project-risks">
            <h3 class="h5">9. Rủi ro</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Tên rủi ro/cơ hội trong dự án</th>
                            <th>Mức độ rủi ro</th>
                            <th>Kế hoạch xử lý rủi ro/cơ hội</th>
                            <th>Hạn hoàn thành</th>
                            <th>Trạng thái</th>
                            <th>Rủi ro/cơ hội còn lại</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.projectRisks and widget.projectRisks.length">
                            <t t-foreach="widget.projectRisks" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase']" /></td>
                                    <td><t t-esc="o['name']" /></td>
                                    <td><t t-esc="o['level']"/></td>
                                    <td class="w-30"><t t-raw="o['recover']" widget="html"/></td>
                                    <td><t t-esc="o['deadline']"/></td>
                                    <td><t t-esc="o['stage']"/></td>
                                    <td>
                                        <t t-if="o['risk_leftover'].length">
                                            <ul>
                                                <t t-foreach="o['risk_leftover']" t-as="i">
                                                    <li><t t-esc="i['detailed_cause']"/></li>
                                                </t>
                                            </ul>
                                        </t>
                                        <t t-else="">
                                            Không còn rủi ro/cơ hội
                                        </t>
                                    </td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="7" class="text-center">Không có rủi ro</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>
    <t t-name="ProjectProblems">
        <div class="chart-container card-shadow project-problems">
            <h3 class="h5">10. Vấn đề</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Mô tả vấn đề</th>
                            <th>Ảnh hưởng</th>
                            <th>Phương án giải quyết</th>
                            <th>Hạn hoàn thành</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.projectProblems and widget.projectProblems.length">
                            <t t-foreach="widget.projectProblems" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase']" /></td>
                                    <td><t t-esc="o['name']" /></td>
                                    <td class="w-30"><t t-raw="o['effect']"/></td>
                                    <td class="w-30"><t t-raw="o['solution_plan']"/></td>
                                    <td><t t-esc="o['deadline']"/></td>
                                    <td><t t-esc="o['stage']"/></td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="6" class="text-center">Không có vấn đề</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>
    <t t-name="ProjectSurveys">
        <div class="chart-container card-shadow project-surveys">
            <h3 class="h5">11. Survey khách hàng</h3>
            <hr/>
            <div class="table-responsive crm_scroll_table">
                <table class="table table-hover" id="project_info_table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Giai đoạn</th>
                            <th>Ngày lấy survey</th>
                            <th>Điểm</th>
                            <th>Ý kiến khách hàng</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="widget.projectSurveys and widget.projectSurveys.length">
                            <t t-foreach="widget.projectSurveys" t-as="o">
                                <tr>
                                    <td><t t-esc="o_index + 1" /></td>
                                    <td><t t-esc="o['phase']" /></td>
                                    <td><t t-esc="o['date']" /></td>
                                    <td><t t-esc="o['point']"/></td>
                                    <td><t t-esc="o['customer_comment']"/></td>
                                </tr>
                            </t>
                        </t>
                        <t t-else="">
                            <tr>
                                <td colspan="4" class="text-center">Không có survey khách hàng</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </div>
    </t>
    <t t-name="ProjectQaEvaluation">
    <div class="chart-container card-shadow project-qa-evaluation">
        <h3 class="h5">12. Báo cáo kiểm soát của QA dự án</h3>
        <hr/>
        <div class="table-responsive crm_scroll_table">
            <table class="table table-hover" id="project_info_table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Ngày tạo</th>
                        <th>Tiến độ dự án</th>
                        <th>Chất lượng dự án</th>
                        <th>Tuân thủ quy trình</th>
                        <th>Nghiệm Thu/ thanh toán</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-if="widget.projectQaEvaluation and widget.projectQaEvaluation.length">
                        <t t-foreach="widget.projectQaEvaluation" t-as="o">
                            <tr>
                                <td><t t-esc="o_index + 1" /></td>
                                <td><t t-esc="o['date']" /></td>
                                <td class="w-25"><t t-raw="o['slow_progress']" /></td>
                                <td class="w-25"><t t-raw="o['not_stay_on_track']" /></td>
                                <td class="w-25"><t t-raw="o['non_compliance']" /></td>
                                <td class="w-25"><t t-raw="o['acceptance_payment']" /></td>
                            </tr>
                        </t>
                    </t>
                    <t t-else="">
                        <tr>
                            <td colspan="6" class="text-center">
                                Không có báo cáo kiểm soát của QA dự án
                            </td>
                        </tr>
                    </t>
                </tbody>
            </table>
        </div>
    </div>
</t>
</templates>