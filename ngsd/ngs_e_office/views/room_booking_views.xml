<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="room_booking_view_search" model="ir.ui.view">
        <field name="name">Bookings search view</field>
        <field name="model">calendar.event</field>
        <field name="arch" type="xml">
            <search string="Booking">
                <field name="name" string="Meeting name"/>
                <field name="user_id"/>
                <field name="room_id"/>
                <field name="office_id"/>
                <filter string="Đã lưu" name="active" domain="[('active','=',False)]"/>
                <filter name="user_id" string="My Meetings" domain="[('user_id', '=', uid)]"/>
                <filter name="group_by_user_id" context="{'group_by': 'user_id'}"/>
                <filter name="group_by_room_id" context="{'group_by': 'room_id'}"/>
                <filter name="group_by_office_id" context="{'group_by': 'office_id'}"/>
            </search>
        </field>
    </record>

    <record id="room_booking_view_gantt" model="ir.ui.view">
        <field name="name">room.booking.view.gantt</field>
        <field name="model">calendar.event</field>
        <field name="arch" type="xml">
            <gantt
                date_start="start"
                date_stop="stop"
                default_scale="day"
                color="room_id"
                default_group_by="room_id"
                precision="{'day': 'hour:quarter', 'week': 'day:half', 'month': 'day:half', 'year': 'day:full'}"
                dynamic_range="1"
                string="Bookings"
                plan="0"
                total_row="True"
                display_unavailability="1"
                thumbnails="{'room_id': 'room_background_image'}"
            >
                <templates>
                    <div t-name="gantt-popover">
                        <div t-if="user_id"><strong>Người book: </strong> <t t-esc="user_id[1]"/></div>
                        <div><t t-esc="start.format('l LT ')"/><i class="fa fa-long-arrow-right" title="Arrow"/><t t-esc="userTimezoneStopDate.format(' l LT')"/></div>
                    </div>
                </templates>
                <field name="user_id"/>
                <field name="start"/>
                <field name="stop"/>
            </gantt>
        </field>
    </record>

<!--    <record id="room_booking_view_calendar" model="ir.ui.view">-->
<!--        <field name="name">room.booking.view.calendar</field>-->
<!--        <field name="model">calendar.event</field>-->
<!--        <field name="arch" type="xml">-->
<!--            <calendar date_start="start" date_stop="stop" color="room_id" event_open_popup="1">-->
<!--                <field name="room_id"/>-->
<!--            </calendar>-->
<!--        </field>-->
<!--    </record>-->

    <record id="room_booking_view_calendar" model="ir.ui.view">
        <field name="name">room_booking_view_calendar</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_calendar"/>
        <field name="arch" type="xml">
            <xpath expr="//calendar" position="attributes">
                <attribute name="color">room_id</attribute>
                <attribute name="form_view_id">%(calendar.view_calendar_event_form)d</attribute>
                <attribute name="quick_add">False</attribute>
<!--                <attribute name="js_class">room_booking</attribute>-->
            </xpath>
            <xpath expr="//field[@name='attendee_status']" position="replace"/>
            <xpath expr="//field[@name='partner_ids']" position="after">
                <field name="room_id" filters="1" avatar_field="room_background_image"/>
                <field name="attendee_status" string="Trạng thái tham gia"/>
            </xpath>
            <xpath expr="//field[@name='privacy']" position="after">
                <field name="is_private_booking" invisible="1"/>
            </xpath>
        </field>
    </record>


    <record id="room_booking_view_list" model="ir.ui.view">
        <field name="name">room.booking.view.list</field>
        <field name="model">calendar.event</field>
        <field name="arch" type="xml">
            <list duplicate="0">
                <field name="start"/>
                <field name="stop"/>
                <field name="name" string="Name"/>
                <field name="room_id"/>
                <field name="user_id" widget="many2one_avatar_user"/>
                <field name="en_department_id"/>
                <field name="department_id"/>
                <field name="is_locked" invisible="1"/>
            </list>
        </field>
    </record>

    <record id="view_calendar_event_tree_inherit" model="ir.ui.view">
        <field name="name">calendar.event.inherit</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='location']" position="after">
                <field name="department_id" optional="show"/>
                <field name="en_department_id" optional="show"/>
                <field name="is_locked" invisible="1"/>
            </xpath>
        </field>
    </record>

    <record id="room_booking_view_kanban" model="ir.ui.view">
        <field name="name">room.booking.view.kanban</field>
        <field name="model">calendar.event</field>
        <field name="arch" type="xml">
            <kanban>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <strong class="o_kanban_record_title">
                                    <field name="display_name"/>
                                    <field name="is_locked" invisible="1"/>
                                </strong>
                            </div>
                            <div class="oe_kanban_content">
                                <ul class="ps-1 mb-0 list-unstyled">
                                    <li>
                                        <strong>Room: </strong>
                                        <field name="room_id"/>
                                    </li>
                                    <li>
                                        <strong>Date: </strong>
                                        <field name="start"/>
                                        <i class="fa fa-long-arrow-right mx-1" title="Until"/>
                                        <field name="stop"/>
                                    </li>
                                </ul>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left"/>
                                <div class="oe_kanban_bottom_right">
                                    <field name="user_id" widget="many2one_avatar_user"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="room_booking_view_form" model="ir.ui.view">
        <field name="name">room.booking.view.form</field>
        <field name="model">calendar.event</field>
        <field name="inherit_id" ref="calendar.view_calendar_event_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='start']" position="before">
                <field name="room_id"/>
                <field name="price" force_save="1"/>
                <field name="number_participants"/>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="department_id"/>
                <field name="en_department_id"/>
                <field name="is_locked" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='partner_ids']" position="attributes">
                <attribute name="domain">[('is_employee', '=', True)]</attribute>
            </xpath>
            <xpath expr="//field[@name='duration']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', '&amp;', ('id', '!=', False), ('recurrency','=',True), ('is_locked','=',True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='videocall_location']" position="before">
                <field name="is_online" />
                <field name="videocall_channel_id" force_save="1" invisible="1"  />
            </xpath>
            
            <xpath expr="//field[@name='videocall_location']" position="attributes">
                <attribute name="widget">CopyClipboardChar</attribute>
            </xpath>
            <xpath expr="//page[@name='page_details']//group//group//div" position="after">
                <field name="rounded_duration" />
            </xpath>
        </field>
    </record>

    <record id="room_booking_action" model="ir.actions.act_window">
        <field name="name">Đặt phòng họp</field>
        <field name="res_model">calendar.event</field>
        <field name="view_mode">calendar,gantt,kanban,form</field>
        <field name="domain">[('room_id', '!=', False)]</field>
        <field name="context">{'room_booking_gantt_show_all_rooms': True}</field>
        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'calendar', 'view_id': False}),
                (0, 0, {'view_mode': 'gantt', 'view_id': ref('room_booking_view_gantt')}),
                (0, 0, {'view_mode': 'list', 'view_id': False}),
                (0, 0, {'view_mode': 'kanban', 'view_id': ref('room_booking_view_kanban')}),
                (0, 0, {'view_mode': 'form', 'view_id': False}),
                ]"/>
    </record>
</odoo>
