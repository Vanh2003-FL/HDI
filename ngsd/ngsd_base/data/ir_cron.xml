<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
    <record id="x_sale_contract_cron" model="ir.cron">
        <field name="name">Job chạy 1 lần/ngày</field>
        <field name="model_id" ref="base.model_ir_model"/>
        <field name="state">code</field>
        <field name="code">env['x.sale.contract'].search([('state', '=', 'done'), '|', '&amp;', ('fixed_date_end', '!=', False), ('fixed_date_end', '&lt;', datetime.date.today()), '&amp;', ('fixed_date_end', '=', False), ('x_date_end', '&lt;', datetime.date.today())]).write({'state': 'expired'})</field>
        <field name='interval_number'>5</field>
        <field name="nextcall" eval="(datetime.now()).strftime('%Y-%m-%d 07:00:00')"/>
        <field name='interval_type'>days</field>
        <field name="active">1</field>
    </record>
    <data>
        <record id="convert_resource_to_list_resource" model="ir.cron">
            <field name="name">Cập nhật danh sách nhân sự từ KHNL về DSNS</field>
            <field name="model_id" ref="project.model_project_project"/>
            <field name="state">code</field>
            <field name="code">model._convert_resource_to_list_resource()</field>
            <field name='interval_number'>1</field>
            <field name='interval_type'>days</field>
            <field name="active">0</field>
        </record>
        <record id="departure_employee_everyday" model="ir.cron">
            <field name="name">Dừng nhân viên hàng ngày</field>
            <field name="model_id" ref="model_hr_employee"/>
            <field name="state">code</field>
            <field name="code">model.action_departure_pause_employee()</field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.now()).strftime('%Y-%m-%d 19:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
        <record id="send_notify_expire_lender_employee" model="ir.cron">
            <field name="name">Gửi thông báo nhân viên sắp hết thời gian mượn</field>
            <field name="model_id" ref="model_en_lender_employee_detail"/>
            <field name="state">code</field>
            <field name="code">model.action_send_mail_ahead_schedule()</field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.now()).strftime('%Y-%m-%d 01:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
        <record id="return_employee_everyday" model="ir.cron">
            <field name="name">Trả nhân viên mượn khi hết hạn</field>
            <field name="model_id" ref="model_en_lender_employee_detail"/>
            <field name="state">code</field>
            <field name="code">model.action_return_on_time()</field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.now()).strftime('%Y-%m-%d 00:10:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
        <record id="send_mail_to_employee_cron" model="ir.cron">
            <field name="name">Gửi mail thông báo tới người dùng</field>
            <field name="model_id" ref="model_email_data"/>
            <field name="state">code</field>
            <field name="code">model._cron_send_mail()</field>
            <field name='interval_number'>5</field>
            <field name="nextcall" eval="(datetime.now()).strftime('%Y-%m-%d 00:00:00')"/>
            <field name='interval_type'>minutes</field>
            <field name="active">1</field>
        </record>
    </data>
    <data>
        <record id="crm_lead_new_cron" model="ir.cron">
            <field name="name">Remind</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="state">code</field>
            <field name="code">model.send_noti_new()</field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + timedelta(days=4 - datetime.today().weekday())).strftime('%Y-%m-%d 04:00:00')"/>
            <field name='interval_type'>weeks</field>
            <field name="active">1</field>
        </record>
    </data>
    <data>
        <record id="noti_not_target_month_cron" model="ir.cron">
            <field name="name">Daily Remind</field>
            <field name="model_id" ref="hr.model_hr_employee"/>
            <field name="state">code</field>
            <field name="code">model.noti_not_target_month()</field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + timedelta(days=1)).strftime('%Y-%m-%d 04:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
    </data>
    <data>
        <record id="noti_not_target_year_cron" model="ir.cron">
            <field name="name">Monthly Remind</field>
            <field name="model_id" ref="hr.model_hr_employee"/>
            <field name="state">code</field>
            <field name="code">model.noti_not_target_year()</field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(months=1,day=1, days=-1)).strftime('%Y-%m-%d 04:00:00')"/>
            <field name='interval_type'>months</field>
            <field name="active">1</field>
        </record>
        <record id="crm_lead_is_lost_cron" model="ir.cron">
            <field name="name">NGSD: Cập nhật lại trạng thái thua</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="state">code</field>
            <field name="code">tasks = env['crm.lead'].search([('active', '=', False)])
for task in tasks:
    task.action_set_lost()</field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(months=1,day=1, days=-1)).strftime('%Y-%m-%d 04:00:00')"/>
            <field name='interval_type'>months</field>
            <field name="active">0</field>
        </record>
        <record id="auto_create_technical_compute" model="ir.cron">
            <field name="name">NGSD: Sinh sẵn bảng tech model để tính toán</field>
            <field name="model_id" ref="ngsd_base.model_en_technical_model"/>
            <field name="state">code</field>
            <field name="code">env['en.technical.model'].auto_create_technical_compute()
            </field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(days=1)).strftime('%Y-%m-%d 17:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
        <record id="auto_create_technical_date" model="ir.cron">
            <field name="name">NGSD: Sinh sẵn bảng tech date để tính toán</field>
            <field name="model_id" ref="ngsd_base.model_en_technical_date"/>
            <field name="state">code</field>
            <field name="code">env['en.technical.date'].auto_create_technical_compute()
            </field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(days=1)).strftime('%Y-%m-%d 17:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
        <record id="ir_cron_fill_date_qa" model="ir.cron">
            <field name="name">NGSD: Xử lý dữ liệ cũ Điền ngày tạo QA</field>
            <field name="model_id" ref="ngsd_base.model_qa_evaluate"/>
            <field name="state">code</field>
            <field name="code">env.cr.execute('update qa_evaluate set date = create_date where date != create_date')
            </field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(days=1)).strftime('%Y-%m-%d 17:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">0</field>
        </record>
        <record id="ir_cron_update_workload_lender" model="ir.cron">
            <field name="name">NGSD: Xử lý dữ liệu: cập nhật workload mượn nhân sự</field>
            <field name="model_id" ref="ngsd_base.model_en_lender_employee_detail"/>
            <field name="state">code</field>
            <field name="code">id = []
workload = 0
model.browse(id).write({'workload': workload})
env['en.department.resource'].search([('lender_employee_detail_id', '=', id)]).write({'workload': workload})
            </field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(days=1)).strftime('%Y-%m-%d 17:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">0</field>
        </record>
        <record id="ir_cron_update_en_project_vicepm_ids_project" model="ir.cron">
            <field name="name">NGSD: Xử lý dữ liệu: cập nhật lại vice PM</field>
            <field name="model_id" ref="project.model_project_project"/>
            <field name="state">code</field>
            <field name="code">id = []
projects = model.search([('en_project_vicepm_id', '!=', False)])
for project in projects:
    if not project.en_project_vicepm_ids:
        project.write({'en_project_vicepm_ids': [(4, project.en_project_vicepm_id.id)]})
            </field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(days=1)).strftime('%Y-%m-%d 17:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">0</field>
        </record>
        <record id="ir_cron_recreate_missing_department_resource_lender" model="ir.cron">
            <field name="name">NGSD: Xử lý dữ liệu Sinh lại bản ghi mượn nhân sự</field>
            <field name="model_id" ref="ngsd_base.model_en_lender_employee_detail"/>
            <field name="state">code</field>
            <field name="code">
returns = model.search([('state', '=', 'returned')])
for line in returns:
    if not env['en.department.resource'].search([('lender_employee_detail_id', '=', line.id)]):
        value = {
            'employee_id': line.employee_id.id,
            'job_position_id': line.job_position_id.id,
            'level_id': line.level_id.id,
            'workload': line.workload,
            'date_start': line.date_start,
            'date_end': line.date_return,
            'borrow_department_id': line.lender_employee_id.department_borrower_id.id,
            'lender_employee_detail_id': line.id,
            'state': 'returned',
        }
        env['en.department.resource'].create(value)
            </field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(days=1)).strftime('%Y-%m-%d 17:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">0</field>
        </record>
        <record id="ir_cron_recompute_date_old_en_hr_overtime" model="ir.cron">
            <field name="name">NGSD: Xử lý dữ liệu Điền lại ngày trong OT</field>
            <field name="model_id" ref="ngsd_base.model_en_hr_overtime"/>
            <field name="state">code</field>
            <field name="code">
model.sudo().search([]).recompute_date_old()
            </field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(days=1)).strftime('%Y-%m-%d 17:00:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">0</field>
        </record>
        <record id="ir_cron_employee_tag_cron_auto_apply" model="ir.cron">
            <field name="name">NGSD: Tự động gắn thẻ thành viên theo thâm niên</field>
            <field name="model_id" ref="hr.model_hr_employee_category"/>
            <field name="state">code</field>
            <field name="code">model.cron_auto_apply()</field>
            <field name='interval_number'>1</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(days=1)).strftime('%Y-%m-%d 17:10:00')"/>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
        <record id="ir_cron_lock_license_action_change_date_expire" model="ir.cron">
            <field name="name">NGSD: Tự động điền ngày khóa chứng từ khi hết hạn</field>
            <field name="model_id" ref="ngsd_base.model_lock_license"/>
            <field name="state">code</field>
            <field name="code">model.action_change_date_expire()</field>
            <field name='interval_number'>5</field>
            <field name='interval_type'>minutes</field>
            <field name="nextcall" eval="(datetime.today() + relativedelta(minutes=5)).strftime('%Y-%m-%d %H:%M:%S')"/>
            <field name="active">1</field>
        </record>
        <record id="ir_cron_lock_license_action_auto_lock_week" model="ir.cron">
            <field name="name">NGSD: Tự động điền ngày khóa chứng từ hàng tuần</field>
            <field name="model_id" ref="ngsd_base.model_lock_license"/>
            <field name="state">code</field>
            <field name="code">model.action_auto_lock()</field>
            <field name='interval_number'>1</field>
            <field name='interval_type'>weeks</field>
<!--            <field name="nextcall" eval="(datetime.today() + relativedelta(weekday=0)).strftime('%Y-%m-%d 03:00:00')"/>-->
            <field name="active">1</field>
        </record>
        <record id="ir_cron_lock_license_action_auto_lock_month" model="ir.cron">
            <field name="name">NGSD: Tự động điền ngày khóa chứng từ hàng tháng</field>
            <field name="model_id" ref="ngsd_base.model_lock_license"/>
            <field name="state">code</field>
            <field name="code">model.action_auto_lock()</field>
            <field name='interval_number'>1</field>
            <field name='interval_type'>months</field>
<!--            <field name="nextcall" eval="(datetime.today() + relativedelta(day=24)).strftime('%Y-%m-%d 17:00:00')"/>-->
            <field name="active">1</field>
        </record>
        <record id="ir_cron_auto_allocation_leave" model="ir.cron">
            <field name="name">NGSD: Tự động sinh phân bổ nghỉ phép</field>
            <field name="model_id" ref="ngsd_base.model_ngs_leave_allocation"/>
            <field name="state">code</field>
            <field name="code">model.cron_allocation()</field>
            <field name='interval_number'>1</field>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
        <record id="ir_cron_auto_allocation_leave_birthday" model="ir.cron">
            <field name="name">NGSD: Tự động sinh phân bổ nghỉ phép Sinh nhật</field>
            <field name="model_id" ref="hr.model_hr_employee"/>
            <field name="state">code</field>
            <field name="code">model.cron_create_birthday_allocation()</field>
            <field name='interval_number'>1</field>
            <field name='interval_type'>days</field>
            <field name="active">1</field>
        </record>
        <record id="hr_holidays.hr_leave_allocation_cron_accrual" model="ir.cron">
            <field name="code">model.with_context(fill_date_now=True).cron_auto_update_missing_employee()
model._update_accrual()</field>
        </record>
    </data>
    </data>
</odoo>
