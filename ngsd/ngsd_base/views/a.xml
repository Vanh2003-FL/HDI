<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>

    <record model="ir.actions.client" id="action_en_project_stage_line_import">
        <field name="name">Nhập Giai đoạn</field>
        <field name="tag">import</field>
        <field name="params">{'model':'en.project.stage','import_field':'wbs_version.id','show_required':True}</field>
        <field name="target">new</field>
    </record>

    <record model="ir.actions.client" id="action_en_workpackage_line_import">
        <field name="name">Nhập Gói công việc</field>
        <field name="tag">import</field>
        <field name="params">{'model':'en.workpackage','import_field':'wbs_version.id','show_required':True}</field>
        <field name="target">new</field>
    </record>

    <record model="ir.actions.client" id="action_project_task_line_import">
        <field name="name">Nhập Công việc</field>
        <field name="tag">import</field>
        <field name="params">{'model':'project.task','import_field':'en_wbs_id.id','show_required':True}</field>
        <field name="target">new</field>
    </record>

    <record id="wbs_form" model="ir.ui.view">
        <field name="model">en.wbs</field>
        <field name="arch" type="xml">
            <form create="0">
                <header>
                    <field name="sent_ok" invisible="1"/>
                    <field name="approve_ok" invisible="1"/>
                    <field name="technical_field_27795" invisible="1"/>
                    <button string="So sánh phiên bản" type="object" name="button_version_account_report_wizard_act"/>
                    <button string="Tạo phiên bản mới" groups="ngsd_base.group_pm,ngsd_base.group_vpm" type="object" name="button_new_version_wbs" invisible="technical_field_27795 == False"/>
                    <button string="Gửi duyệt" groups="ngsd_base.group_pm,ngsd_base.group_vpm" type="object" name="button_sent" invisible="state != 'draft' or sent_ok == False"/>
                    <button string="Duyệt" type="object" name="button_approved" invisible="state != 'awaiting' or approve_ok == False"/>
                    <button string="Từ chối" type="object" name="button_refused" invisible="state != 'awaiting' or approve_ok == False"/>
                    <field name="state" widget="statusbar"/>
                    <button name="action_open_wbs_export" string="Xuất" type="object" class="oe_highlight"/>
                </header>
                <sheet>
                    <div name="button_box" class="oe_button_box">
                        <button class="oe_stat_button" type="object" name="button_wbs_account_report_wizard_act" icon="fa-pencil-square-o" string="Xem báo cáo"/>
                    </div>
                    <group>
                        <group>
                            <field name="project_id" readonly="1" force_save="1" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                            <field name="user_id" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}" readonly="state != 'draft'"/>
                            <field name="resource_plan_id" required="0" force_save="1" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                        </group>
                        <group>
                            <field name="version_number"/>
                            <field name="version_type"/>
                            <field name="parent_id" invisible="version_type != 'plan'"/>
                            <field name="en_mm_conversion"/>
                            <field name="en_md"/>
                            <field name="en_mh_total"/>
                            <field name="en_wbs_mh_total"/>
                            <field name="project_date_start" invisible="1"/>
                            <field name="project_date" invisible="1"/>
                            <field name="seq_id" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Giai đoạn">
                            <button class="btn-primary"
                                    name="import_project_stage_action"
                                    type="object"
                                    string="Nhập Giai đoạn"
                                    invisible="state != 'draft'"
                            />
                            <br/>
                            <field name="project_stage_ids" context="{ 'default_date_start': project_date_start, 'default_date_end': project_date}" readonly="state != 'draft'"/>
                        </page>
                        <page string="Gói công việc">
                            <button class="btn-primary"
                                    name="import_workpackage_action"
                                    type="object"
                                    string="Nhập Gói công việc"
                                    invisible="state != 'draft'"
                            />
                            <br/>
                            <field name="workpackage_ids" options="{'create':0, 'delete':[('state','!=','approved')]}"/>
                        </page>
                        <page string="Công việc">
                            <button class="btn-primary"
                                    name="import_project_task_action"
                                    type="object"
                                    string="Nhập Công việc"
                                    invisible="state != 'draft'"
                            />
                            <br/>
                            <field name="en_wbs_task_ids" options="{'create':0, 'delete':[('state','!=','approved')]}" context="{'list_view_ref': 'ngsd_base.view_task_in_wbs_view_tree'}" readonly="state != 'draft'"/>
                        </page>
                        <page string="Thông tin phê duyệt">
                            <group>
                                <group>
                                    <field name="en_request_user_id"/>
                                    <field name="en_next_approver_ids" widget="many2many_tags"/>
                                </group>
                                <group>
                                    <field name="en_request_date"/>
                                </group>
                            </group>
                            <field name="en_approve_line_ids"/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="wbs_form_create_popup" model="ir.ui.view">
        <field name="model">en.wbs</field>
        <field name="inherit_id" ref="wbs_form"/>
        <field name="mode">primary</field>
        <field name="priority">10000</field>
        <field name="arch" type="xml">
<!--            <xpath expr="//div[hasclass('oe_chatter')]" position="replace">-->
<!--                <footer>-->
<!--                    <button name="button_confirm_create_wbs" string="Xác nhận" type="object" class="btn-primary" context="{'allow_active': True}"/>-->
<!--                    <button special="cancel" string="Hủy" class="btn-secondary"/>-->
<!--                </footer>-->
<!--            </xpath>-->
            <xpath expr="//form" position="attributes">
                <attribute name="class">wbs_form_create_popup</attribute>
            </xpath>
        </field>
    </record>


    </data>
</odoo>