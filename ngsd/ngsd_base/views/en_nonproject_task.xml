<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="en_nonproject_task_tree" model="ir.ui.view">
        <field name="model">en.nonproject.task</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="en_pic_id"/>
                <field name="en_start_date"/>
                <field name="en_end_date"/>
                <field name="en_state"/>
                <field name="en_department_id" optional="hide"/>
                <field name="en_task_type" optional="hide"/>
                <field name="en_supervisor_id" optional="hide"/>
                <field name="en_estimate_hour" optional="hide"/>
                <field name="en_fin_percentage" optional="hide"/>
            </list>
        </field>
    </record>
    <record id="en_nonproject_task_form" model="ir.ui.view">
        <field name="model">en.nonproject.task</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="en_state" widget="statusbar" options="{'clickable': '1'}"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
                            <field class="text-break" name="name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="en_department_id"/>
                            <field name="en_task_type" required="1"/>
                            <field name="en_pic_id"/>
                            <field name="en_supervisor_id"/>
                            <field name="en_supervisor_ids" invisible="1"/>
                        </group>
                        <group>
                            <field name="en_start_date"/>
                            <field name="en_end_date"/>
                            <field name="en_estimate_hour"/>
                            <field name="en_fin_percentage" widget="percentage"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Timesheet">
                            <field name="timesheet_ids" context="{'copy_fields': ['employee_id', 'name', 'unit_amount']}">
                                <list editable="bottom" string="Timesheet Activities" default_order="date desc" class="allow_list_copy">
                                    <field name="date" attrs="{'readonly': [('en_state', '!=', 'new')]}"/>
                                    <field name="employee_id" required="1" widget="many2one_avatar_employee" context="{'active_test': True}" attrs="{'readonly': [('en_state', '!=', 'new')]}"/>
                                    <field name="name" attrs="{'readonly': [('en_state', '!=', 'new')]}"/>
                                    <field name="unit_amount" widget="timesheet_uom" decoration-danger="unit_amount &gt; 24" attrs="{'readonly': [('en_state', '!=', 'new')]}"/>
                                    <field name="ot_time" widget="float_time"/>
                                    <field name="ot_state"/>
                                    <field name="ot_date_from" optional="hide"/>
                                    <field name="ot_date_to" optional="hide"/>
                                    <field name="en_state"/>
                                    <field name="request_date"/>
                                    <field name="approver"/>
                                    <field name="approve_date"/>

                                    <button string="Tăng ca" name="en_create_over_time_nonproject" type="object" icon="fa-clock-o" attrs="{'invisible': [('en_state','in', ['waiting', 'cancel']), ('ot_id','=',False)]}"/>
                                    <button string="Gửi duyệt" confirm="Bạn có chắc chắn muốn gửi duyệt?" name="en_button_sent" type="object" icon="fa-paper-plane" attrs="{'invisible':['|',('en_state','!=','new'),('en_sent_ok','=',False)]}"/>
                                    <button string="Duyệt" confirm="Duyệt yêu cầu, tiếp tục?" name="en_button_approved" type="object" icon="fa-check" attrs="{'invisible':['|',('en_state','!=','sent'),('en_approve_ok','=',False)]}"/>
                                    <button string="Từ chối" confirm="Từ chối yêu cầu, tiếp tục?" name="en_button_cancel" type="object" icon="fa-times" attrs="{'invisible':['|',('en_state','!=','sent'),('en_approve_ok','=',False)]}"/>
                                    <button string="Yêu cầu hủy duyệt" name="en_button_waiting" type="object" icon="fa-paper-plane" attrs="{'invisible':['|',('en_state','!=','approved'),('en_sent_ok','=',False)]}"/>
                                    <button string="Xác nhận hủy duyệt" name="en_button_cancel2" type="object" icon="fa-check" attrs="{'invisible':['|',('en_state','!=','waiting'),('en_approve_ok','=',False)]}"/>
                                    <button string="Từ chối hủy duyệt" name="en_button_cancel_cancel" type="object" icon="fa-times" attrs="{'invisible':['|',('en_state','!=','waiting'),('en_approve_ok','=',False)]}"/>
                                    <button string="Hủy yêu cầu hủy duyệt" name="en_button_cancel_cancel" type="object" icon="fa-times" attrs="{'invisible':['|',('en_state','!=','waiting'),('en_sent_ok','=',False)]}"/>
<!--                                    <button string=" " name="button_en_copy" type="object" icon="fa-clipboard"/>-->
                                    <field name="ot_id" invisible="1"/>
                                    <field name="en_approve_ok" invisible="1"/>
                                    <field name="en_sent_ok" invisible="1"/>
                                    <field name="en_total_amount" optional="hide" widget="timesheet_uom"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="user_id" invisible="1"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="en_nonproject_task_search" model="ir.ui.view">
        <field name="model">en.nonproject.task</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="en_pic_id"/>
            </search>
        </field>
    </record>
    
    <record id="en_nonproject_task_all_action" model="ir.actions.act_window">
        <field name="name">Tất cả công việc</field>
        <field name="res_model">en.nonproject.task</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record id="en_nonproject_task_my_task_action" model="ir.actions.act_window">
        <field name="name">Công việc của tôi</field>
        <field name="res_model">en.nonproject.task</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('en_pic_id', '=', uid)]</field>
    </record>


</odoo>