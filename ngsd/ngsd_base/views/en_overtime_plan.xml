<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
    <record id="en_overtime_plan_tree" model="ir.ui.view">
        <field name="model">en.overtime.plan</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="create_uid" string="Người tạo"/>
                <field name="create_date" string="Thời gian tạo" optional="show"/>
                <field name="en_next_approver_ids" widget="many2many_tags"/>
                <field name="user_approved_ids" widget="many2many_tags" optional="hide"/>
                <field name="last_approver_date" string="Thời gian duyệt" optional="show"/>
                <field name="en_project_code"/>
                <field name="en_project_id"/>
                <field name="department_id"/>
                <field name="en_project_stage_id"/>
                <field name="en_workpackage_id"/>
                <field name="en_work_id"/>
                <field name="state"/>
                <field name="en_date"/>
                <field name="en_hours" widget="float_time" sum="en_hours"/>
                <field name="en_time_used" widget="float_time" sum="en_time_used" optional="show"/>
                <field name="en_reason_ot" optional="show"/>
                <field name="en_work_location" optional="show"/>
                <field name="approve_ok" invisible="1"/>
                <button string="Duyệt" type="object" name="button_approved" icon="fa-check" invisible="state != 'to_approve' or not approve_ok"/>
                <button string="Từ chối" type="object" name="button_refused" icon="fa-times" invisible="state != 'to_approve' or not approve_ok"/>
            </list>
        </field>
    </record>
    <record id="en_overtime_plan_tree_1" model="ir.ui.view">
        <field name="model">en.overtime.plan</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="create_uid" string="Người tạo"/>
                <field name="create_date" string="Thời gian tạo" optional="show"/>
                <field name="en_next_approver_ids" widget="many2many_tags"/>
                <field name="user_approved_ids" widget="many2many_tags" optional="hide"/>
                <field name="last_approver_date" string="Thời gian duyệt" optional="show"/>
                <field name="department_id"/>
                <field name="en_work_nonproject_id"/>
                <field name="state"/>
                <field name="en_date"/>
                <field name="en_hours" widget="float_time" sum="en_hours"/>
                <field name="en_time_used" widget="float_time" sum="en_time_used" optional="show"/>
                <field name="en_reason_ot" optional="show"/>
                <field name="en_work_location" optional="show"/>
                <field name="approve_ok" invisible="1"/>
                <button string="Duyệt" type="object" name="button_approved" icon="fa-check" invisible="state != 'to_approve' or not approve_ok"/>
                <button string="Từ chối" type="object" name="button_refused" icon="fa-times" invisible="state != 'to_approve' or not approve_ok"/>
            </list>
        </field>
    </record>

    <record id="en_overtime_plan_search" model="ir.ui.view">
        <field name="name">en.overtime.plan.search</field>
        <field name="model">en.overtime.plan</field>
        <field name="arch" type="xml">
            <search string="">
                 <field name="name" string="Tất cả"
                        filter_domain="['|','|','|','|','|','|','|','|','|','|',('name', 'ilike', self),('create_uid', 'ilike', self),('en_next_approver_ids', 'ilike', self),('en_project_code', 'ilike', self),('en_project_id', 'ilike', self),('department_id', 'ilike', self),('en_project_stage_id', 'ilike', self),('en_workpackage_id', 'ilike', self),('en_work_id', 'ilike', self),('state', 'ilike', self),('en_reason_ot', 'ilike', self)]"/>
                    <field name="en_request_user_id" string="Người gửi duyệt"/>
                    <field name="en_project_id" string="Dự án"/>
                <filter string="Kế hoạch OT cần duyệt" domain="[('state','=','to_approve'), ('en_next_approver_ids', 'in', [uid])]" name="filter_to_approve"/>
            </search>
        </field>
    </record>

    <record id="en_overtime_plan_form" model="ir.ui.view">
        <field name="model">en.overtime.plan</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="sent_ok" invisible="1"/>
                    <field name="approve_ok" invisible="1"/>
                    <button string="Gửi duyệt" type="object" name="button_sent" invisible="state != 'draft' or not sent_ok"/>
                    <button string="Duyệt" type="object" name="button_approved" invisible="state != 'to_approve' or not approve_ok"/>
                    <button string="Từ chối" type="object" name="button_refused" invisible="state != 'to_approve' or not approve_ok"/>

                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">

                    </div>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" force_save="1"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="create_uid" string="Người tạo yêu cầu OT"/>
                            <field name="en_project_id" options="{'no_create': True}" invisible="not en_work_inproject" required="en_work_inproject"/>
                            <field name="en_project_ids" invisible="1"/>
                            <field name="en_reason_ot" required="1"/>
                            <field name="en_work_id" invisible="not en_work_inproject" required="en_work_inproject" options="{'no_create': True}"/>
                            <field name="en_work_nonproject_id" invisible="en_work_inproject" required="not en_work_inproject"/>
                            <field name="en_work_location"/>
                            <field name="en_work_domain" invisible="1"/>
                            <field name="en_work_nonproject_domain" invisible="1"/>
                            <field name="en_work_inproject" invisible="1"/>
                        </group>
                        <group>
                            <field name="en_date" required="1"/>
                            <field name="en_hours" widget="float_time" required="1"/>
                            <field name="en_inf_hr_id" invisible="en_work_inproject"/>
                            <field name="en_inf_user_id" invisible="en_work_inproject" required="not en_work_inproject"/>
                            <field name="en_reason_refuse" invisible="state != 'refused'"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Thông tin phê duyệt">
                            <group>
                                <group>
                                    <field name="en_request_user_id"/>
                                    <field name="en_next_approver_ids" widget="many2many_tags"/>
                                </group>
                                <group>
                                    <field name="en_request_date"/>
                                    <field name="user_approved_ids" widget="many2many_tags" invisible="1"/>
                                </group>
                            </group>
                            <field name="en_approve_line_ids"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="en_overtime_plan_action" model="ir.actions.act_window">
        <field name="name">Kế hoạch OT</field>
        <field name="res_model">en.overtime.plan</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_en_work_inproject': True, 'search_default_filter_to_approve': 1}</field>
        <field name="domain">[('en_work_inproject', '=', True)]</field>
        <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'list', 'view_id': ref('en_overtime_plan_tree')})]"/>
    </record>
    <record id="en_overtime_plan_menu" model="ir.ui.menu">
        <field name="name">Kế hoạch OT</field>
        <field name="action" ref="en_overtime_plan_action"/>
    </record>

    <record id="en_overtime_plan_nonproject_action" model="ir.actions.act_window">
        <field name="name">Kế hoạch OT</field>
        <field name="res_model">en.overtime.plan</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_en_work_inproject': False, 'search_default_filter_to_approve': 1}</field>
        <field name="domain">[('en_work_inproject', '=', False)]</field>
        <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'list', 'view_id': ref('en_overtime_plan_tree_1')})]"/>
    </record>

    </data>
</odoo>