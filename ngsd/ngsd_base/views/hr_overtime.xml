<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="hr_overtime_tree" model="ir.ui.view">
        <field name="model">en.hr.overtime</field>
        <field name="arch" type="xml">
            <list>
                <field name="type_id" invisible="1"/>
                <field name="employee_barcode"/>
                <field name="employee_id"/>
                <field name="en_next_approver_ids" widget="many2many_tags"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <field name="project_code"/>
                <field name="project_id"/>
                <field name="department_id"/>
                <field name="time" widget="float_time"/>
                <field name="type_ids" widget="many2many_tags" optional="hide"/>
                <field name="state"/>
            </list>
        </field>
    </record>
    <record id="hr_overtime_tree_1" model="ir.ui.view">
        <field name="model">en.hr.overtime</field>
        <field name="arch" type="xml">
            <list>
                <field name="type_id" invisible="1"/>
                <field name="department_id"/>
                <field name="employee_barcode"/>
                <field name="employee_id"/>
                <field name="en_next_approver_ids" widget="many2many_tags"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <field name="en_nonproject_task_id"/>
                <field name="time" widget="float_time"/>
                <field name="en_task_type"/>
                <field name="type_ids" widget="many2many_tags" optional="hide"/>
                <field name="state"/>
            </list>
        </field>
    </record>
    <record id="hr_overtime_form" model="ir.ui.view">
        <field name="model">en.hr.overtime</field>
        <field name="arch" type="xml">
            <form class="hr_overtime_form_view">
                <header>
                    <field name="sent_ok" invisible="1"/>
                    <field name="approve_ok" invisible="1"/>
                    <button string="Gửi duyệt" type="object" name="button_sent" attrs="{'invisible':['|',('state','!=','new'),('sent_ok','=',False)]}"/>
                    <button string="Xác nhận" type="object" name="button_approved" attrs="{'invisible':['|',('state','!=','requested'),('approve_ok','=',False)]}"/>
                    <button string="Từ chối" type="object" name="button_refused" attrs="{'invisible':['|',('state','!=','requested'),('approve_ok','=',False)]}"/>
                    <button string="CHuyển về Mới" type="object" name="button_new" attrs="{'invisible':[('can_new','=',False)]}" />

                    <field name="can_request" invisible="1"/>
                    <field name="can_cancel" invisible="1"/>
                    <field name="can_approve" invisible="1"/>
                    <field name="can_reject" invisible="1"/>
                    <field name="can_new" invisible="1"/>
                    <button name="button_requested" attrs="{'invisible':[('can_request','=',False)]}" type="object" string="Gửi duyệt" invisible="1"/>
                    <button name="button_cancel" attrs="{'invisible':[('can_cancel','=',False)]}" type="object" string="Hủy" invisible="0"/>
                    <button name="button_approved" attrs="{'invisible':[('can_approve','=',False)]}" type="object" string="Xác nhận" invisible="0"/>
                    <button name="button_rejected" attrs="{'invisible':[('can_reject','=',False)]}" type="object" string="Từ chối" invisible="1"/>
                    <field name="state" widget="statusbar" statusbar_visible="new,requested,approved,rejected"/>
                </header>
                <div class="alert alert-warning text-center o_form_header alert-dismissible"
                     attrs="{'invisible': [('count_overtime', '=', 0)]}" role="status">
                    <button class="btn-close" data-bs-dismiss="alert" aria-label="Close"/>
                    <button name="to_overtime_overlimit" type="object" class="btn-link pr-1">
                        <field name="count_overtime"/> tăng ca
                    </button>
                    <span class="align-middle">vượt quá giới hạn thời gian.</span>
                </div>
                <sheet>
                    <div class="oe_button_box" name="button_box">

                    </div>
                    <div class="oe_title">
                        <label for="employee_id" class="oe_edit_only"/>
                        <h1>
                            <field name="employee_id"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="detail_count" invisible="1"/>
                            <field name="date_from" invisible="1"/>
                            <field name="date_to" invisible="1"/>
                            <field name="date"/>
                            <field name="time_start" widget="float_time" attrs="{'readonly': [('state', '!=', 'new')]}"/>
                            <field name="time_end" widget="float_time" attrs="{'readonly': [('state', '!=', 'new')]}"/>
                            <field name="time" widget="float_time"/>
                            <field name="type_ids" widget="many2many_tags" attrs="{'invisible': [('detail_count', '>', 1)]}"/>
                            <field name="rate" attrs="{'invisible': [('detail_count', '>', 1)]}"/>
                        </group>
                        <group>
                            <field name="approver_id" invisible="1"/>
                            <field name="technical_field_27821" invisible="1"/>
                            <field name="technical_field_27817" invisible="1" widget="many2many_tags"/>
                            <field name="task_id" attrs="{'invisible': [('task_id', '=', False)]}" domain="[('id','in',technical_field_27817)]" readonly="1" force_save="1" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                            <field name="en_nonproject_task_id" attrs="{'invisible': [('en_nonproject_task_id', '=', False)]}" readonly="1" force_save="1" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                            <field name="en_overtime_plan_id" options="{'no_create':True,'no_quick_create':True,'no_create_edit':True}" attrs="{'readonly': [('state', '!=', 'new')]}"/>
                            <field name="description" readonly="1" force_save="1"/>
                            <field name="reason_refused" attrs="{'invisible': [('reason_refused', '=', False)]}"/>
                            <field name="name" invisible="1" readonly="1" force_save="1"/>
                            <field name="en_overtime_plan_domain" invisible="1"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="detail_ids" attrs="{'invisible': [('detail_count', '&lt;=', 1)]}">
                                <list>
                                    <field name="type_id"/>
                                    <field name="hour_start" widget="float_time"/>
                                    <field name="hour_end" widget="float_time"/>
                                    <field name="total_hour" widget="float_time"/>
                                    <field name="rate"/>
                                </list>
                            </field>
                        </group>
                    </group>
                    <notebook>
                        <page string="Thông tin phê duyệt">
                            <group>
                                <group>
                                    <field name="en_request_user_id"/>
                                    <field name="en_next_approver_ids" widget="many2many_tags"/>
                                </group>
                                <group>
                                    <field name="en_request_date"/>
                                </group>
                            </group>
                            <field name="en_approve_line_ids"/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter"><field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="hr_overtime_search" model="ir.ui.view">
        <field name="model">en.hr.overtime</field>
        <field name="arch" type="xml">
            <search>
                <field name="type_ids"/>
                <field name="employee_id"/>
                <field name="employee_barcode"/>
                <field name="approver_id"/>
                <filter string="Tăng ca của tôi" domain="[('employee_id.user_id','=',uid)]" name="filter_my_record"/>
                <filter string="Phê duyệt của tôi" domain="[('approver_id','=',uid)]" name="filter_my_approve_record"/>
                <filter string="Nhóm của tôi" domain="[('employee_id.parent_id.user_id','=',uid)]" name="filter_my_child"/>
                <separator/>
                <filter string="Chờ duyệt" domain="[('state','=','requested')]" name="filter_requested"/>
                <filter string="OT cần duyệt" domain="[('state','=','requested'), ('en_next_approver_ids', 'in', [uid])]" name="filter_to_approve"/>
                <group expand="0" string="Group By...">
                    <filter string="Loạt tăng ca" name="groupby_type_ids" context="{'group_by': 'type_ids'}"/>
                    <filter string="Nhân viên" name="groupby_employee_id" context="{'group_by': 'employee_id'}"/>
                    <filter string="Người phê duyệt" name="groupby_approver_id" context="{'group_by': 'approver_id'}"/>
                    <filter string="Ngày bắt đầu" name="groupby_date_from" context="{'group_by': 'date_from'}"/>
                </group>
            </search>
        </field>
    </record>
    <record id="hr_overtime_act" model="ir.actions.act_window">
        <field name="name">Tăng ca của tôi</field>
        <field name="res_model">en.hr.overtime</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_filter_my_record': 1, 'create': 0}</field>
        <field name="domain">[('en_nonproject_task_id', '=', False), ('task_id', '!=', False)]</field>
        <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'list', 'view_id': ref('hr_overtime_tree')})]"/>
    </record>
    <record id="hr_overtime_nonproject_act" model="ir.actions.act_window">
        <field name="name">Tăng ca của tôi</field>
        <field name="res_model">en.hr.overtime</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_filter_my_record': 1, 'create': 0}</field>
        <field name="domain">[('task_id', '=', False), ('en_nonproject_task_id', '!=', False)]</field>
        <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'list', 'view_id': ref('hr_overtime_tree_1')})]"/>
    </record>
    <record id="hr_overtime_menu" model="ir.ui.menu">
        <field name="name">Tăng ca của tôi</field>
        <field name="action" ref="hr_overtime_act"/>
    </record>

    <record id="requested_hr_overtime_act" model="ir.actions.act_window">
        <field name="name">Tất cả tăng ca</field>
        <field name="res_model">en.hr.overtime</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'create': 0, 'search_default_filter_to_approve': 1, }</field>
        <field name="domain">[('en_nonproject_task_id', '=', False), ('task_id', '!=', False)]</field>
        <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'list', 'view_id': ref('hr_overtime_tree')})]"/>
    </record>
    <record id="requested_hr_overtime_nonproject_act" model="ir.actions.act_window">
        <field name="name">Tất cả tăng ca</field>
        <field name="res_model">en.hr.overtime</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'create': 0, 'search_default_filter_to_approve': 1, }</field>
        <field name="domain">[('task_id', '=', False), ('en_nonproject_task_id', '!=', False)]</field>
        <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'list', 'view_id': ref('hr_overtime_tree_1')})]"/>
    </record>
    <record id="requested_hr_overtime_menu" model="ir.ui.menu">
        <field name="name">Tất cả tăng ca</field>
        <field name="action" ref="requested_hr_overtime_act"/>
    </record>
    <record id="hr_overtime_setting_action" model="ir.actions.act_window">
        <field name="name">Cài đặt</field>
        <field name="res_model">res.config.settings</field>
        <field name="view_mode">form</field>
        <field name="target">inline</field>
        <field name="context">{'module' : 'mbank_overtime', 'bin_size': False}</field>
    </record>
    <record id="hr_overtime_setting_menu" model="ir.ui.menu">
        <field name="name">Thiết lập thời gian tăng ca tối đa</field>
        <field name="action" ref="hr_overtime_setting_action"/>
    </record>
</odoo>