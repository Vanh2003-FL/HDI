<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record model="ir.actions.client" id="action_en_resource_project_import">
        <field name="name">Nhập Danh sách nhân sự</field>
        <field name="tag">import</field>
        <field name="params">{'model':'resource.project','import_field':'project_id.id','show_required':True}</field>
        <field name="target">new</field>
    </record>

    <record model="ir.actions.client" id="action_quality_control_import">
        <field name="name">Nhập KH KSCL</field>
        <field name="tag">import</field>
        <field name="params">{'model':'en.quality.control','import_field':'project_id.id','show_required':True}</field>
        <field name="target">new</field>
    </record>

    <record model="ir.actions.client" id="action_en_resource_planning_line_import">
        <field name="name">Nhập Kế hoạch nguồn lực</field>
        <field name="tag">import</field>
        <field name="params">{'model':'en.resource.planning','import_field':'project_id.id','show_required':True}</field>
        <field name="target">new</field>
    </record>

    <record model="ir.actions.client" id="action_en_wbs_line_import">
        <field name="name">Nhập Kế hoạch WBS</field>
        <field name="tag">import</field>
        <field name="params">{'model':'en.wbs','import_field':'project_id.id','show_required':True}</field>
        <field name="target">new</field>
    </record>

    <record id="inf_project_primary" model="ir.ui.view">
        <field name="model">en.inf.project</field>
        <field name="priority">-1000</field>
        <field name="arch" type="xml">
            <list>
                <field name="id"/>
            </list>
        </field>
    </record>
    <record id="inf_project_graph" model="ir.ui.view">
        <field name="model">en.inf.project</field>
        <field name="priority">-1000</field>
        <field name="arch" type="xml">
            <graph stacked="0">
                <field name="technical_field_28197" interval="month"/>
                <field name="type"/>
                <field name="value" type="measure"/>
            </graph>
        </field>
    </record>
    <record id="inf_project_tree" model="ir.ui.view">
        <field name="model">en.inf.project</field>
        <field name="priority">23071993</field>
        <field name="arch" type="xml">
            <list>
                <field name="project_id"/>
                <field name="type"/>
                <field name="value"/>
                <field name="date_start"/>
                <field name="date"/>
            </list>
        </field>
    </record>
    <record id="inf_project_search" model="ir.ui.view">
        <field name="model">en.inf.project</field>
        <field name="priority">23071993</field>
        <field name="arch" type="xml">
            <search>
                <field name="project_id"/>
            </search>
        </field>
    </record>
    <record id="project_project_28105_form" model="ir.ui.view">
        <field name="model">project.project</field>
        <field name="priority">12012024</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <field name="en_bmm_ids" string="_" force_save="1">
                        <list editable="bottom" create="0" delete="0">
                            <field name="date" force_save="1" invisible="1"/>
                            <field name="month_txt" force_save="1"/>
                            <field name="bmm" force_save="1"/>
                        </list>
                    </field>
                </sheet>
                <footer>
                    <button name="en_do" string="Xác nhận" type="object" class="btn-primary"/>
                    <button string="Hủy" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
    <!-- Commented out due to missing hr_org_chart_overview module
    <record id="action_org_chart_overview" model="ir.actions.client">
        <field name="name">Sơ đồ tổ chức dự án</field>
        <field name="tag">hr_org_chart_overview</field>
        <field name="target">main</field>
        <field name="params">{'model': 'en.resource.planning'}</field>
    </record>
    -->
    <record id="refuse_reason_form" model="ir.ui.view">
        <field name="model">en.refuse.reason.wizard</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                    </group>
                </sheet>
                <footer>
                    <button string="Xác nhận" class="oe_highlight" type="object" name="do"/>
                    <button string="Hủy" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="view_project_kanban" model="ir.ui.view">
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="on_create"/>
            </xpath>
        </field>
    </record>
    <record id="view_project" model="ir.ui.view">
        <field name="inherit_id" ref="project.view_project"/>
        <field name="priority">1000000</field>
        <field name="arch" type="xml">
            <list position="replace">
                <list decoration-muted="active == False" string="Projects" delete="0" multi_edit="1" sample="1">
                    <field name="name" optional="show"/>
                    <field name="en_code" optional="show"/>
                    <field name="en_project_qa_id" optional="show"/>
                    <field name="user_id" optional="show"/>
                    <field name="en_project_manager_id" optional="show"/>
                    <field name="en_department_id" optional="show"/>
                    <field name="name_partner" optional="show"/>
                    <field name="en_state" optional="show"/>
                    <field name="active" invisible="1"/>
                </list>
            </list>
        </field>
    </record>

    <record id="edit_project" model="ir.ui.view">
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="priority">23071993</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='stage_id']" position="after">
                <field name="en_state" invisible="1"/>
            </xpath>
            <field name="label_tasks" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="tag_ids" position="after">
                <field name="en_code" readonly="en_state != 'draft'"/>
                <field name="is_presale" invisible="1"/>
                <field name="is_internal"/>
                <field name="en_area_id"
                        required="not is_presale"
                       options="{'no_create': True, 'no_create_edit': True, 'no_quick_create': True}"/>
                <field name="en_block_id"
                        required="not is_presale"
                       options="{'no_create': True, 'no_create_edit': True, 'no_quick_create': True}"
                       domain="['|', ('area_id', '=?', en_area_id),('en_area_ids', '=', en_area_id)]"/>
                <field name="en_department_id" options="{'no_create': True, 'no_create_edit': True, 'no_quick_create': True}" domain="[('block_id', '=', en_block_id)]" required="not is_presale"/>
                <field name="en_project_type_id" options="{'no_create': True, 'no_create_edit': True, 'no_quick_create': True}"/>
                <field name="en_list_project_id" options="{'no_create': True, 'no_create_edit': True, 'no_quick_create': True}"/>
                <field name="en_project_model_id" options="{'no_create': True, 'no_create_edit': True, 'no_quick_create': True}"/>
            </field>
            <field name="tag_ids" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="user_id" position="before">
                <field name="en_project_implementation_id"/>
                <field name="en_project_block_id"/>
                <field name="en_project_manager_id"/>
            </field>
            <field name="user_id" position="after">
                <field name="en_project_vicepm_ids" widget="many2many_avatar_user"/>
                <field name="en_project_qa_id"/>
                <field name="en_project_sale_id"/>
                <field name="en_project_accountant_id"/>

<!--                <field name="en_response_rate" widget="percentage"/>-->
<!--                <field name="en_processing_rate" widget="percentage"/>-->
            </field>
            <xpath expr="//group/group[1]" position="attributes">
                <attribute name="string">Thông tin dự án</attribute>
            </xpath>
            <xpath expr="//group/group[2]" position="attributes">
                <attribute name="string">Quản lý</attribute>
            </xpath>
            <xpath expr="//page[@name='settings']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//group" position="after">
                <group>
                    <group string="Thông tin khách hàng" invisible="is_internal">
                        <field name="en_customer_type_id"/>
                        <field name="partner_id" widget="res_partner_many2one" domain="[('is_customer','=',True)]"
                               context="{'view_all_res_partner': True}" required="not is_internal"/>
                        <field name="en_contract_type_id"/>
                        <field name="en_contract_number"/>
                        <field name="en_branch_id"/>
                        <field name="currency_id"/>
                        <field name="customer_resource_calendar_id"/>
                    </group>
                    <group string="Thông tin chi tiết">
                        <field name="en_bmm"/>
                        <field name="en_md_resource"/>
                        <field name="technical_field_28187" string="Nguồn lực thực tế (MM)"/>
                        <field name="en_resource_id"/>
                        <field name="mm_rate" invisible="1"/>
                        <field name="mm_conversion"/>
                        <field name="en_current_version" groups="ngsd_base.group_tpvh,ngsd_base.group_qam,ngsd_base.group_pm,ngsd_base.group_gdkndu,ngsd_base.group_gdkv,ngsd_base.group_vpm"/>
                        <field name="en_link_system" widget="url"/>
                        <field name="show_import_button" groups="base.group_system"/>
                        <field name="show_import_button_viewer" invisible="1"/>
                    </group>
                </group>
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="to_project_dashboard" type="object" class="oe_stat_button" icon="fa-area-chart">
                    <span class="o_stat_text">
                        Dashboard Dự án
                    </span>
                </button>
                <button class="oe_stat_button" type="object" name="to_folder" icon="fa-folder" groups="ngsd_base.group_tpvh,ngsd_base.group_gdkndu,ngsd_base.group_pm,ngsd_base.group_tvda,ngsd_base.group_qam,ngsd_base.group_gdkv,ngsd_base.group_vpm">
                    <field name="en_folder_count" widget="statinfo"/>
                </button>
                <button class="oe_stat_button" type="object" name="to_risk" icon="fa-folder" groups="ngsd_base.group_tpvh,ngsd_base.group_gdkndu,ngsd_base.group_pm,ngsd_base.group_tvda,ngsd_base.group_qam,ngsd_base.group_gdkv,ngsd_base.group_vpm">
                    <field name="en_risk_count" widget="statinfo"/>
                </button>
                <button class="oe_stat_button" type="object" name="button_en_problem_act" icon="fa-folder" groups="ngsd_base.group_tpvh,ngsd_base.group_gdkndu,ngsd_base.group_pm,ngsd_base.group_tvda,ngsd_base.group_qam,ngsd_base.group_gdkv,ngsd_base.group_vpm">
                    <field name="en_problem_count" widget="statinfo"/>
                </button>
                <button class="oe_stat_button" type="object" name="to_project_document" icon="fa-check" groups="ngsd_base.group_tpvh,ngsd_base.group_gdkndu,ngsd_base.group_pm,ngsd_base.group_tvda,ngsd_base.group_qam,ngsd_base.group_gdkv,ngsd_base.group_vpm">
                    <field name="en_document_count" widget="statinfo"/>
                </button>
            </xpath>
            <!-- Đã xóa xpath button to_work_plans - project.act_project_project_2_project_task_all không tồn tại trong Odoo 18 -->
            <xpath expr="//group/group/field[@name='partner_id']" position="replace"/>
            <xpath expr="//field[@name='stage_id']" position="attributes">
                <attribute name="options">{'fold_field': 'fold'}</attribute>
            </xpath>
            <xpath expr="//field[@name='stage_id']" position="before">
                <field name="technical_field_27795" invisible="1"/>
                <button name="button_new_wbs" groups="ngsd_base.group_pm,ngsd_base.group_vpm" string="Tạo WBS" type="object" invisible="en_wbs_ids"/>
                <button name="button_project_account_report_wizard_act" groups="ngsd_base.group_tpvh,ngsd_base.group_gdkndu,ngsd_base.group_tptc,ngsd_base.group_pm,ngsd_base.group_qam,ngsd_base.group_vpm" string="Nguồn lực dự án" invisible="not en_resource_ids" type="object"/>
                <button name="button_view_qdtlda" string="Biểu mẫu QĐTL" type="object"/>
                <button name="button_view_qddcda" string="Biểu mẫu QDĐC" type="object"/>
                <button name="new_resource" groups="ngsd_base.group_pm,ngsd_base.group_vpm" string="Tạo kế hoạch NL" invisible="en_resource_ids or en_state not in ('draft','wait_for_execution','doing')" type="object"/>
                <button name="new_quality_control" groups="ngsd_base.group_qam,ngsd_base.group_qal,ngsd_base.group_pm,ngsd_base.group_gdkndu" string="Tạo KSCL" invisible="en_quality_control_ids or en_state not in ('draft','wait_for_execution','doing')" type="object"/>
                <button name="button_en_wait_for_execution" groups="ngsd_base.group_qam" string="Chờ thực hiện" invisible="en_state not in ('draft',)" type="object"/>
                <button name="button_en_doing" groups="ngsd_base.group_qam" string="Thực hiện" invisible="en_state not in ('wait_for_execution',)" type="object"/>
                <button name="button_en_complete" groups="ngsd_base.group_qam" string="Hoàn thành" invisible="en_state not in ('doing',)" type="object"/>
                <button name="button_pending" groups="ngsd_base.group_qam" string="Trì hoãn" invisible="en_state not in ('draft', 'wait_for_execution', 'doing')" type="object"/>
                <button name="button_continue" groups="ngsd_base.group_qam" string="Tiếp tục" invisible="en_state != 'pending'" type="object" class="oe_highlight"/>
                <button name="button_en_cancel" groups="ngsd_base.group_qam" string="Hủy" invisible="en_state not in ('draft', 'wait_for_execution', 'doing')" type="object" confirm="Thực hiện thao tác hủy dự án này, tiếp tục?"/>
            </xpath>
            <xpath expr="//group[@name='extra_settings']" position="inside">
                <field name="type_ids" widget="many2many_tags" domain="[('user_id','=',False)]"/>
            </xpath>
            <page name="description" position="before">
                <page name="bmm" string="BMM" invisible="0">
                    <group>
                        <group>

                            <field name="en_bmm_ids" force_save="1" nolabel="1">
                                <list editable="bottom" create="0" delete="0" default_order="date">
                                    <field name="date" force_save="1" invisible="1"/>
                                    <field name="month_txt" force_save="1"/>
                                    <field name="bmm" force_save="1"/>
                                </list>
                            </field>

                        </group>
                        <group>

                        </group>
                    </group>

                </page>
                <page string="Danh sách nhân sự">
                    <group>
                        <div class="o_row">

                            <button class="btn-primary"
                                    name="import_en_resource_project"
                                    type="object"
                                    string="Nhập Danh sách nhân sự"
                                    invisible="not id"
                            />
                       <br/>

<!--                            <button class="btn-primary"-->
<!--                                    name="export_data_resource"-->
<!--                                    type="object"-->
<!--                                    string="Xuất Danh sách nhân sự"-->
<!--                                    attrs="{'invisible': 0}"-->
<!--                            />-->

                    </div>
                    </group>
                    <field name="en_resource_project_ids">
                        <list editable="bottom" decoration-muted="state == 'inactive'">
                            <field name="type_id" options="{'no_create': True, 'no_open': True}" readonly="state == 'inactive'" required="1"/>
                            <field name="employee_id" context="{'ctx_domain_resource_project': domain_resource_project}"/>
                            <field name="email"/>
                            <field name="role_ids" widget="many2many_tags" readonly="state == 'inactive'" required="1"/>
                            <field name="en_job_position_ids" widget="many2many_tags" readonly="state == 'inactive'" required="1"/>
                            <field name="date_start" readonly="state == 'inactive'" required="1"/>
                            <field name="date_end" readonly="state == 'inactive'" required="1"/>
                            <field name="is_borrow" optional="hide"/>
<!--                            <field name="employee_borrow_ids" invisible="1"/>-->
                            <field name="department_id" invisible="1"/>
                            <field name="en_state"/>
                            <field name="date_leave" readonly="1" force_save="1"/>
                            <field name="state" readonly="1" force_save="1"/>
                            <button confirm="Bạn chắc chắn muốn nhân sự này rời dự án, tiếp tục?" string="Rời dự án" name="button_leave_project" type="object" icon="fa-sign-out" invisible="state == 'inactive'"/>
                            <field name="domain_resource_project" invisible="1"/>
                        </list>
                    </field>
                </page>
                <page string="Cam kết tỉ lệ phản hồi/xử lý">
                    <div class="row col-12 col-lg-12">
                        <div class="col-6">
                            <group string="Cam kết tỉ lệ phản hồi">
                                <field name="en_response_rate_ids" nolabel="1">
                                    <list editable="bottom">
                                        <field name="start_date"/>
                                        <field name="end_date"/>
                                        <field name="rate" widget="percentage"/>
                                    </list>
                                </field>
                            </group>
                        </div>
                        <div class="col-6">
                            <group string="Cam kết tỉ lệ xử lý">
                                <field name="en_processing_rate_ids" nolabel="1">
                                    <list editable="bottom">
                                        <field name="start_date"/>
                                        <field name="end_date"/>
                                        <field name="rate" widget="percentage"/>
                                    </list>
                                </field>
                            </group>
                        </div>
                    </div>
                </page>
                <page string="Kế hoạch WBS" invisible="not show_wbs_tab">
                    <field name="show_wbs_tab" invisible="1"/>
                    <button class="btn-primary"
                            name="import_wbs"
                            type="object"
                            string="Nhập WBS"
                            invisible="en_wbs_ids or not id"
                    />

                    <field name="en_wbs_ids" readonly="1">
                        <list>
                            <field name="version_number"/>
                            <field name="version_type"/>
                            <field name="state"/>
                            <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" title="Mở bản ghi mới"/>
                        </list>
                    </field>
                </page>
                <page string="Kế hoạch nguồn lực" invisible="not show_resource_tab">
                    <field name="show_resource_tab" invisible="1"/>
                    <button class="btn-primary oe_read_only"
                            name="import_en_resource_planning_line"
                            type="object"
                            string="Nhập Kế hoạch nguồn lực"
                            invisible="not show_import_button_viewer"
                    />
                    <br/>

                    <field name="en_resource_ids" readonly="1">
                        <list>
                            <field name="name"/>
                            <field name="user_id"/>
                            <field name="create_date" string="Ngày tạo"/>
                            <field name="count_approver"/>
                            <field name="en_md"/>
                            <field name="budget_over" widget="percentage"/>
                            <field name="baseline_over" widget="percentage"/>
                            <field name="reason"/>
                            <field name="state"/>
                            <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" title="Mở bản ghi mới"/>
                        </list>
                    </field>
                </page>
                <page string="KH KSCL dự án" groups="ngsd_base.group_qam,ngsd_base.group_qal,ngsd_base.group_pm,ngsd_base.group_gdkndu,ngsd_base.group_vpm">
                    <button class="btn-primary"
                            name="import_en_quality_control"
                            type="object"
                            string="Nhập KH KSCL dự án"
                            invisible="not id"
                    />
                    <br/>
                    <field name="en_quality_control_ids" readonly="1">
                        <list>
                            <field name="name"/>
                            <field name="user_id"/>
                            <field name="create_date" string="Ngày tạo"/>
                            <field name="reason"/>
                            <field name="state"/>
                            <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" title="Mở bản ghi mới"/>
                        </list>
                    </field>
                </page>
                <page string="Báo cáo kiểm soát của QA dự án" groups="ngsd_base.group_qal,ngsd_base.group_qam">
                    <field name="en_qa_evaluate_ids">
                        <list editable="bottom">
                            <field name="type" invisible="1"/>
                            <field name="date"/>
                            <field name="slow_progress"/>
                            <field name="not_stay_on_track"/>
                            <field name="non_compliance"/>
                            <field name="acceptance_payment"/>
<!--                            <field name="state"/>-->
<!--                            <field name="qa_valuate"/>-->
                        </list>
                    </field>
                </page>
                <page string="Survey">
                    <field name="en_qa_survey_ids">
                        <list editable="bottom">
                            <field name="date"/>
                            <field name="phase"/>
                            <field name="point"/>
                            <field name="customer_comment"/>
                        </list>
                    </field>
                </page>
                <page string="Lịch sử nguồn lực cũ">
                    <field name="en_history_resource_ids">
                        <list editable="bottom">
                            <field name="month"/>
                            <field name="year"/>
                            <field name="plan"/>
                            <field name="actual"/>
                        </list>
                    </field>
                </page>
            </page>
            <xpath expr="//field[@name='date_start']" position="attributes">
                <attribute name="widget"></attribute>
                <attribute name="options">{}</attribute>
            </xpath>
            <xpath expr="//field[@name='date']" position="attributes">
                <attribute name="widget"></attribute>
                <attribute name="options">{}</attribute>
            </xpath>
            <!-- Đã xóa 2 xpath replace cho button project_share_wizard - không tồn tại trong Odoo 18 -->
            <xpath expr="//field[@name='company_id']" position="before">
                <field name="en_real_start_date"/>
                <field name="en_real_end_date"/>
            </xpath>
            <!-- Đã xóa xpath attributes cho button task - project.act_project_project_2_project_task_all không tồn tại trong Odoo 18 -->
        </field>
    </record>

    <record id="project_project_stage_view_tree" model="ir.ui.view">
        <field name="inherit_id" ref="project.project_project_stage_view_tree"/>
        <field name="arch" type="xml">
            <field name="fold" position="before">
                <field name="en_state"/>
                <field name="en_required_field_ids" widget="many2many_tags"/>
            </field>
        </field>
    </record>

    <record id="project_stage_tree" model="ir.ui.view">
        <field name="model">en.project.stage</field>
        <field name="arch" type="xml">
            <list>
                <field name="stage_type_id"/>
                <field name="stage_code"/>
                <field name="name"/>
                <field name="start_date"/>
                <field name="end_date"/>
                <field name="state"/>
                <field name="payment_milestone"/>
                <field name="project_milestone"/>
                <field name="wbs_version_old" invisible="1"/>
            </list>
        </field>
    </record>
    <record id="project_stage_form" model="ir.ui.view">
        <field name="model">en.project.stage</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="a_ok" invisible="1"/>
                    <field name="b_ok" invisible="1"/>
                    <field name="c_ok" invisible="1"/>
                    <field name="d_ok" invisible="1"/>
                    <field name="e_ok" invisible="1"/>
                    <button name="button_en_a" type="object" string="Hủy" invisible="not a_ok"/>
                    <button name="button_en_b" type="object" string="Gửi xem xét" invisible="not b_ok"/>
                    <button name="button_en_c" type="object" string="Trì hoãn" invisible="not c_ok"/>
                    <button name="button_en_d" type="object" string="Làm lại" invisible="not d_ok"/>
                    <button name="button_en_e" type="object" string="Hoàn thành" invisible="not e_ok"/>
                    <field name="state" widget="statusbar" options="{'clickable': 1}" readonly="0"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="project_id"/>
                            <field name="start_date"/>
                            <field name="en_real_start_date"/>
                            <field name="en_approver_id"/>
                            <field name="payment_milestone"/>
                        </group>
                        <group>
                            <field name="stage_code"/>
                            <field name="stage_type_id" options="{'no_create': True}"/>
                            <field name="end_date"/>
                            <field name="en_real_end_date"/>
                            <field name="project_milestone"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Gói công việc">
                            <field name="order_line" context="{'default_date_start': start_date, 'default_date_end': end_date}">
                                <list editable="bottom" class="allow_list_copy">
                                    <field name="wp_code"/>
                                    <field name="name"/>
                                    <field name="technical_field_27536" invisible="1" widget="many2many_tags"/>
                                    <field name="user_id" domain="[('id','in',technical_field_27536)]" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                                    <field name="date_start"/>
                                    <field name="date_end"/>
                                    <field name="state"/>
                                    <field name="wbs_version_old" invisible="1"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <record id="project_stage_act" model="ir.actions.act_window">
        <field name="res_model">en.project.stage</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="project_document_tree" model="ir.ui.view">
        <field name="model">en.project.document</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="project_id"/>
                <field name="en_state"/>
                <field name="doc_type"/>
                <field name="doc_version"/>
                <field name="user_id"/>
                <field name="internal_approver_id"/>
                <field name="internal_examiner_id"/>
                <field name="handover_date"/>
                <field name="real_ho_date"/>
                <field name="en_payment_milestone"/>
                <field name="state"/>
                <field name="workpackage_id" invisible="1"/>
            </list>
        </field>
    </record>
    <record id="project_document_form" model="ir.ui.view">
        <field name="model">en.project.document</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="state" widget="statusbar" options="{'clickable': '1'}"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="project_id" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}" readonly="0" force_save="1"/>
                            <field name="workpackage_id" invisible="1" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                            <field name="name"/>
                            <field name="en_state"/>
                            <field name="doc_type"/>
                            <field name="doc_version"/>
                            <field name="real_ho_date"/>
                            <field name="out_assess"/>
                            <field name="external_assesser" invisible="not out_assess"/>
                            <field name="description"/>
                            <field name="en_payment_milestone"/>
                            <field name="en_project_milestone"/>
                        </group>
                        <group>
                            <field name="user_id"/>
                            <field name="internal_approver_id" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                            <field name="internal_examiner_id" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                            <field name="doc_area"/>
                            <field name="handover_date"/>
                            <field name="out_approve"/>
                            <field name="external_approver" invisible="not out_approve"/>
                            <field name="product_url" widget="url"/>
                            <field name="data_attachment" filename="file_name"/>
                            <field name="file_name" invisible="1"/>
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter"><field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>
    <record id="project_document_form1" model="ir.ui.view">
        <field name="inherit_id" ref="project_document_form"/>
        <field name="mode">primary</field>
        <field name="priority">10</field>
        <field name="arch" type="xml">
            <form position="inside">
            </form>
        </field>
    </record>
    <record id="project_document_form2" model="ir.ui.view">
        <field name="inherit_id" ref="project_document_form"/>
        <field name="priority">20</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='project_id']" position="replace"/>
        </field>
    </record>
    <record id="ngsd_view_project_project_filter" model="ir.ui.view">
        <field name="inherit_id" ref="project.view_project_project_filter"/>
        <field name="priority">1000</field>
        <field name="arch" type="xml">
            <!-- Đã xóa 4 xpath replace - các field/filter không tồn tại trong Odoo 18: status, sale_order_id, analytic_account_id, tag_ids -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="en_code"/>
                <field name="en_project_qa_id"/>
                <field name="en_project_manager_id"/>
<!--                <field name="user_id"/>-->
                <field name="en_department_id"/>
            </xpath>

        </field>
    </record>
    <record id="project_document_act" model="ir.actions.act_window">
        <field name="res_model">en.project.document</field>
        <field name="view_mode">tree,form</field>
    </record>
    <!--    <record id="project_document_menu" model="ir.ui.menu">-->
    <!--        <field name="action" ref="project_document_act"/>-->
    <!--    </record>-->

    <record id="workpackage_tree" model="ir.ui.view">
        <field name="model">en.workpackage</field>
        <field name="arch" type="xml">
            <list class="allow_list_copy">
                <field name="project_stage_id" required="1"/>
                <field name="wp_code"/>
                <field name="parent_id"/>
                <field name="name"/>
                <field name="user_id" domain="[('id','in',technical_field_27536)]" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                <field name="date_start"/>
                <field name="date_end"/>
                <field name="state"/>
                <field name="technical_field_27536" invisible="1" widget="many2many_tags"/>
                <field name="wbs_version" invisible="1"/>
                <field name="wbs_version_old" invisible="1"/>
            </list>
        </field>
    </record>
    <record id="workpackage_form" model="ir.ui.view">
        <field name="model">en.workpackage</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="a_ok" invisible="1"/>
                    <field name="b_ok" invisible="1"/>
                    <field name="c_ok" invisible="1"/>
                    <field name="d_ok" invisible="1"/>
                    <field name="e_ok" invisible="1"/>
                    <button name="button_en_a" type="object" string="Hủy" invisible="not a_ok"/>
                    <button name="button_en_b" type="object" string="Gửi xem xét" invisible="not b_ok"/>
                    <button name="button_en_c" type="object" string="Trì hoãn" invisible="not c_ok"/>
                    <button name="button_en_d" type="object" string="Làm lại" invisible="not d_ok"/>
                    <button name="button_en_e" type="object" string="Hoàn thành" invisible="not e_ok"/>
                    <field name="state" widget="statusbar" options="{'clickable': 1}" readonly="0"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="wp_code"/>
                            <field name="project_id"/>
                            <field name="project_stage_id" readonly="1" force_save="1"/>
                            <field name="technical_field_27536" invisible="1" widget="many2many_tags"/>
                            <field name="user_id" domain="[('id','in',technical_field_27536)]" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                            <field name="en_approver_id"/>
                            <field name="pj_milestone"/>
                        </group>
                        <group>
                            <field name="name"/>
                            <field name="wbs_version"/>
                            <field name="date_start"/>
                            <field name="en_real_start_date"/>
                            <field name="date_end"/>
                            <field name="en_real_end_date"/>
                            <field name="handover_doc"/>
                            <field name="parent_id" readonly="1" force_save="1"/>
                            <field name="en_small_package_ids" widget="many2many_tags"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Gói việc con" invisible="task_ids">
                            <field name="child_ids" options="{'create':[('wbs_state','!=','approved')],'delete':[('wbs_state','!=','approved')]}" context="{'default_user_id': user_id, 'default_date_start': date_start, 'default_date_end': date_end}"/>
                        </page>
                        <page string="Công việc" invisible="child_ids">
                            <field name="task_ids" options="{'create':[('wbs_state','!=','approved')],'delete':[('wbs_state','!=','approved')]}" context="{'default_en_start_date': date_start, 'default_date_deadline': date_end, 'default_project_id': project_id}">
                                <list class="allow_list_copy">
                                    <field name="en_task_code"/>
                                    <field name="name"/>
                                    <field name="technical_field_27450" widget="many2many_tags" invisible="1"/>
                                    <field name="en_handler" required="1" domain="[('id','in',technical_field_27450)]" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}"/>
                                    <field name="stage_id"/>
                                    <field name="en_start_date"/>
                                    <field name="date_deadline"/>
                                    <field name="en_wbs_old_id" invisible="1"/>
                                </list>
                            </field>
                        </page>
                        <page string="Sản phẩm bàn giao" invisible="not handover_doc">
                            <field name="document_ids" context="{'form_view_ref': 'ngsd_base.project_document_form1'}"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <record id="workpackage_act" model="ir.actions.act_window">
        <field name="res_model">en.workpackage</field>
        <field name="view_mode">tree,form</field>
    </record>


    <record id="wbs_tree" model="ir.ui.view">
        <field name="model">en.wbs</field>
        <field name="arch" type="xml">
            <list create="0" js_class="list_with_export_hint">
                <field name="project_id"/>
                <field name="parent_id" invisible="1"/>
                <field name="version_number"/>
                <field name="user_id"/>
                <field name="state" invisible="0"/>
            </list>
        </field>
    </record>
    <record id="wbs_act" model="ir.actions.act_window">
        <field name="res_model">en.wbs</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{}</field>
    </record>

    <record id="qa_evaluate_view_tree" model="ir.ui.view">
        <field name="name">qa_evaluate_view_tree</field>
        <field name="model">qa.evaluate</field>
        <field name="arch" type="xml">
            <list string="" >
                <field name="state"/>
                <field name="code_project"/>
                <field name="project_id"/>
                <field name="email_qa"/>
                <field name="email_pm"/>
                <field name="qa_valuate"/>
            </list>
        </field>
    </record>

    <record id="qa_evaluate_view_search" model="ir.ui.view">
        <field name="model">qa.evaluate</field>
        <field name="arch" type="xml">
            <search>
                <field name="project_id"/>
                <filter string="Dự án" name="group_project" domain="[]" context="{'group_by': 'project_id'}"/>
                <separator/>
                <filter string="Tuần này" name="current_week"
                        domain="[('create_date', '&gt;=', (context_today() + relativedelta(weeks=-1,days=1, weekday=0)).strftime('%Y-%m-%d')),
                                 ('create_date', '&lt;=', (context_today() - relativedelta(weeks=0, weekday=-1)).strftime('%Y-%m-%d'))]"/>
                <filter string="Tuần trước" name="last_week"
                        domain="[('create_date', '&gt;=', ((context_today() + relativedelta(weeks=-2,days=1, weekday=0)).strftime('%Y-%m-%d'))),
                                 ('create_date', '&lt;=', ((context_today() + relativedelta(weeks=-1,weekday=6)).strftime('%%Y-%%m-%%d')))]"/>
                <separator/>
                <filter string="Tháng này" name="current_month"
                        domain="[('create_date', '&gt;=', (context_today() + relativedelta(day=1)).strftime('%Y-%m-%d')),
                                 ('create_date', '&lt;=', (context_today() + relativedelta(months=1,day=1,days=-1)).strftime('%Y-%m-%d'))]"/>
                <filter string="Tháng trước" name="last_month"
                        domain="[('create_date', '&gt;=', ((context_today() + relativedelta(months=-1,day=1)).strftime('%Y-%m-%d'))),
                                 ('create_date', '&lt;=', ((context_today() + relativedelta(day=1,days=-1)).strftime('%%Y-%%m-%%d')))]"/>
                <separator/>
            </search>
        </field>
    </record>

    <record id="qa_evaluate_view_action" model="ir.actions.act_window">
        <field name="name">Đánh giá của QA</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">qa.evaluate</field>
        <field name="view_mode">list</field>
        <field name="context">{'create': 0, 'edit': 0}</field>
    </record>

    <record id="en_work_plans_view_tree" model="ir.ui.view">
        <field name="name">en.work.plans.tree</field>
        <field name="model">en.work.plans</field>
        <field name="arch" type="xml">
            <list string="" editable="bottom">
                <field name="date_work_plan"/>
                <field name="work_done"/>
                <field name="plan_done"/>
                <field name="total_ticket_ontime_feedback"/>
                <field name="total_ticket_due_feedback"/>
                <field name="total_ticket_ontime_process"/>
                <field name="total_ticket_due_process"/>
                <field name="project_id" readonly="1" force_save="1"/>
            </list>
        </field>
    </record>

    <record id="en_work_plans_view_form" model="ir.ui.view">
        <field name="name">en.work.plans.form</field>
        <field name="model">en.work.plans</field>
        <field name="arch" type="xml">
            <form string="">
                <sheet>
                    <group>
                        <group>
                            <field name="date_work_plan"/>
                            <field name="work_done"/>
                        </group>
                        <group>
                            <field name="project_id" options="{'no_create': True}" readonly="1" force_save="1"/>
                            <field name="plan_done"/>
                        </group>

                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="en_work_plans_action" model="ir.actions.act_window">
        <field name="name">Cập nhật báo cáo tuần</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">en.work.plans</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            <!-- Add Text Here -->
          </p><p>
            <!-- More details about what a user can do with this object will be OK -->
          </p>
        </field>
    </record>

</odoo>