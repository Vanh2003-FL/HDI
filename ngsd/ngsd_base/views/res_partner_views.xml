<odoo>
    <record id="ngsd_res_partner_view_form" model="ir.ui.view">
        <field name="name">ngsd.res.partner.view.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='function']" position="replace"/>
            <xpath expr="//div[hasclass('oe_title')]" position="after">
                <group>
                    <group>
                        <field name="x_code"/>
                        <field name="x_short"/>
                        <field name="function" invisible="company_type != 'person'"/>
                    </group>
                    <group>
                        <field name="activity_user_ids" widget="many2many_tags" required="company_type_res == 'ncs'"/>
                    </group>
                </group>
                <group invisible="1">
                    <group>
                        <field name="company_type_res" invisible="1"/>
                        <field name="is_supplier" invisible="1"/>
                        <field name="is_manufacturer" invisible="1"/>
                    </group>
                    <group>
                        <field name="is_competitors" invisible="1"/>
                        <field name="is_customer" invisible="1"/>
                    </group>
                </group>
            </xpath>
            <xpath expr="//field[@name='function']" position="before">
                <field name="x_gender" invisible="company_type != 'person'"/>
                <field name="x_department" invisible="company_type_res == 'ncs'"/>
            </xpath>
            <field name="activity_user_ids" position="before">
                <field name="customer_code" invisible="is_customer == False or company_type_res != 'ncs'"/>
            </field>
            <xpath expr="//field[@name='vat']" position="attributes">
                <attribute name="required">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='vat']" position="after">
                <field name="x_note" invisible="company_type_res != 'ncs'"/>
            </xpath>
            <xpath expr="//field[@name='website']" position="before">
                <field name="x_dob" invisible="company_type_res != 'ncs'"/>
            </xpath>
            <xpath expr="//field[@name='function']" position="before">
                <field name="customer_category_id" invisible="company_type_res != 'ncs'" required="company_type_res == 'ncs'"/>
                <field name="customer_group_id" invisible="company_type_res != 'ncs'" required="company_type_res == 'ncs'"/>
            </xpath>
            <xpath expr="//notebook/page[@name='sales_purchases']" position="attributes">
                <attribute name="invisible">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='name']" position="after">
                <xpath expr="//field[@name='child_ids']/form//field[@name='function']" position="move"/>
                <field name="activity_user_ids" widget="many2many_tags"/>
            </xpath>
            <!-- Commented out due to XPath element not found in Odoo 18 base view -->
            <!--
            <xpath expr="//span[@name='address_name']/b" position="replace">
                <b invisible="is_company == False or company_type_res == 'ncs'">Ụ sở chính</b>
                <b invisible="is_company == False or company_type_res != 'ncs'">Địa chỉ</b>
            </xpath>
            -->
            <xpath expr="//div[hasclass('o_address_format')]/field[@name='street']" position="attributes">
                <attribute name="readonly">(type == 'contact') and (parent_id != False)</attribute>
                <attribute name="required">is_company == True</attribute>
            </xpath>
            <!--            <xpath expr="//field[@name='vat']" position="attributes">-->
            <!--                <attribute name="required">1</attribute>-->
            <!--            </xpath>-->

            <xpath expr="//field[@name='mobile']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//label[2]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <!--             <xpath expr="//field[@name='email']" position="attributes">
                            <attribute name="invisible">1</attribute>
                        </xpath>
                        <xpath expr="//label[@for='email']" position="attributes">
                            <attribute name="invisible">1</attribute>
                        </xpath> -->

            <xpath expr="//field[@name='city']" position="attributes">
                <attribute name="invisible">company_type_res == 'ncs'</attribute>
                <!-- <attribute name="invisible">0</attribute> -->
            </xpath>

            <xpath expr="//field[@name='zip']" position="attributes">
                <attribute name="invisible">company_type_res == 'ncs'</attribute>
                <!-- <attribute name="invisible">0</attribute> -->
            </xpath>

            <!-- Form view thêm liên hệ con -->
            <xpath expr="//field[@name='child_ids']/form//field[@name='name']" position="after">
                <field name="company_type_res" invisible="1"/>
            </xpath>

            <xpath expr="//field[@name='child_ids']/form//field[@name='name']" position="attributes">
                <attribute name="placeholder">Họ và tên khách hàng</attribute>
                <attribute name="required">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='phone']" position="attributes">
                <attribute name="invisible">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='type']" position="attributes">
                <attribute name="invisible">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='function']" position="attributes">
                <!-- Require chức vụ với NCS, base đang là {'invisible': [('type','!=', 'contact')]} -->
                <attribute name="invisible">type != 'contact'</attribute>
                <attribute name="required">type == 'contact' and company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='name']" position="attributes">
                <attribute name="required">company_type_res == 'ncs'</attribute>
            </xpath>

            <xpath expr="//field[@name='child_ids']/form//field[@name='mobile']" position="attributes">
                <attribute name="required">company_type_res == 'ncs'</attribute>
            </xpath>
            <field name="vat" position="after">
                <field name="x_id"/>
                <field name="x_id_date"/>
                <field name="x_id_issue"/>
            </field>
            <field name="website" position="after">
                <field name="industry_id" position="move"/>
            </field>
            <xpath expr="//field[@name='child_ids']//form//field[@name='email']" position="before">
                <xpath expr="//field[@name='child_ids']//form//field[@name='title']" position="move"/>
            </xpath>
            <xpath expr="//field[@name='child_ids']//form//label[@for='street']" position="attributes">
                <!-- Empty attrs removed for Odoo 18 compatibility -->
            </xpath>
            <xpath expr="//field[@name='child_ids']//form//div" position="attributes">
                <!-- Removed empty attrs attribute for Odoo 18 compatibility -->
            </xpath>
            <xpath expr="//field[@name='child_ids']//form//field[@name='function']" position="after">
                <field name="company_type" invisible="1"/>
                <field name="x_gender" invisible="company_type != 'person' or type not in ['contact','private']"/>
            </xpath>
            <xpath expr="//field[@name='child_ids']" position="attributes">
                <attribute name="context">{'default_parent_id': id, 'default_street': street, 'default_street2': street2, 'default_city': city, 'default_state_id': state_id, 'default_zip': zip, 'default_country_id': country_id, 'default_lang': lang, 'default_user_id': user_id, 'default_type': 'contact'}</attribute>
            </xpath>
            <xpath expr="//field[@name='category_id']" position="after">
                <field name="bfsi_id"/>
            </xpath>

        </field>
    </record>


    <record id="ngsd_res_partner_only_create_child_partner_form" model="ir.ui.view">
        <field name="name">ngsd_res_partner_only_create_child_partner_form</field>
        <field name="model">res.partner</field>
        <field name="priority">100000</field>
        <field name="arch" type="xml">
            <form string="Contact / Address">
                <sheet>
                    <field name="type" required="1" widget="radio" options="{'horizontal': true}"/>
                    <field name="parent_id" invisible="1"/>
                    <hr/>
                    <group>
                        <group>
                            <field name="name" string="Contact Name" required="type == 'contact'"/>
                            <field name="title" options="{'no_open': True}" placeholder="e.g. Mr."
                                invisible="type != 'contact'"/>
                            <field name="function" placeholder="e.g. Sales Director"
                                invisible="type != 'contact'"/>
                            <label for="street" string="Address" invisible="type == 'contact'"/>
                            <div invisible="type == 'contact'">
                                <div class="o_address_format" name="div_address">
                                    <field name="street" placeholder="Street..." class="o_address_street"/>
                                    <field name="street2" placeholder="Street 2..." class="o_address_street"/>
                                    <field name="city" placeholder="City" class="o_address_city"/>
                                    <field name="state_id" class="o_address_state" placeholder="State" options="{'no_open': True, 'no_quick_create': True}" context="{'country_id': country_id, 'default_country_id': country_id, 'zip': zip}"/>
                                    <field name="zip" placeholder="ZIP" class="o_address_zip"/>
                                    <field name="country_id" placeholder="Country" class="o_address_country" options='{"no_open": True, "no_create": True}'/>
                                </div>
                            </div>
                        </group>
                        <group>
                            <field name="email" widget="email"/>
                            <field name="phone" widget="phone"/>
                            <field name="mobile" widget="phone"/>
                            <field name="company_id" invisible="1"/>
                        </group>
                    </group>
                    <group>
                        <field name="comment" placeholder="Internal notes..."/>
                    </group>
                    <field name="lang" invisible="True"/>
                    <field name="user_id" invisible="True"/>
                </sheet>
            </form>

        </field>
    </record>

    <record id="ngsd_res_partner_only_create_child_partner_form_inherit" model="ir.ui.view">
        <field name="name">ngsd_res_partner_only_create_child_partner_form_inherit</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="ngsd_res_partner_only_create_child_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <xpath expr="//field[@name='function']" position="move"/>
                <field name="activity_user_ids" widget="many2many_tags"/>
            </xpath>
            <!-- Form view thêm liên hệ con -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="company_type_res" invisible="1"/>
            </xpath>

            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="placeholder">Họ và tên khách hàng</attribute>
                <attribute name="required">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='email']" position="attributes">
                <attribute name="invisible">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='zip']" position="attributes">
                <attribute name="invisible">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='function']" position="attributes">
                <!-- Require chức vụ với NCS, base đang là {'invisible': [('type','!=', 'contact')]} -->
                <attribute name="invisible">type != 'contact'</attribute>
                <attribute name="required">type == 'contact' and company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="required">company_type_res == 'ncs'</attribute>
            </xpath>

            <xpath expr="//field[@name='mobile']" position="attributes">
                <attribute name="required">company_type_res == 'ncs'</attribute>
            </xpath>
            <xpath expr="///field[@name='email']" position="before">
                <xpath expr="///field[@name='title']" position="move"/>
            </xpath>
            <xpath expr="///label[@for='street']" position="attributes">
                <!-- Empty attrs removed for Odoo 18 compatibility -->
            </xpath>
            <xpath expr="///div" position="attributes">
                <!-- Removed empty attrs attribute for Odoo 18 compatibility -->
            </xpath>
            <xpath expr="///field[@name='function']" position="after">
                <field name="company_type" invisible="1"/>
                <field name="x_gender" invisible="company_type != 'person' or type not in ['contact','private']"/>
            </xpath>
        </field>
    </record>


    <record id="ngsd_res_partner_technical_field_27310_form" model="ir.ui.view">
        <field name="name">ngsd.res.partner.view.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="priority">10000</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='parent_id']" position="replace">
                <field name="technical_field_27310" widget="many2many_tags" invisible="1"/>
                <field name="parent_id" required="1" domain="[('id', '=', technical_field_27310)]" force_save="1"/>
            </xpath>
            <xpath expr="//field[@name='company_type']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <record id="partner_ncs_res_view_tree" model="ir.ui.view">
        <field name="name">ncs.res.partner.view.tree</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <list>
                <!--<button name="action_open_new_tab" string="" type="object" icon="fa-external-link" help="Mở bản ghi mới"/>-->
                <field name="customer_code"/>
                <field name="display_name"/>
                <field name="phone"/>
                <field name="company_type_res"/>
                <field name="customer_category_id"/>
                <field name="activity_user_ids" widget="many2many_tags"/>
            </list>
        </field>
    </record>

    <record id="ngsd_res_partner_customer_view_form" model="ir.ui.view">
        <field name="name">ngsd.res.partner.view.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="priority">1000</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <!--            <xpath expr="//span[@name='address_name']/field[@name='type']" position="attributes">-->
            <!--                <attribute name="invisible">1</attribute>-->
            <!--            </xpath>-->
            <xpath expr="//field[@name='parent_id'][1]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <!--            <xpath expr="//span[@name='address_name']/field[@name='type']" position="after">-->
            <!--                <field name="customer_type" attrs="{'invisible': [('is_company','=', True)], 'required': [('is_company','!=', True)], 'readonly': [('user_ids', '!=', [])]}" class="font-weight-bold"/>-->
            <!--            </xpath>-->
        </field>
    </record>

    <record id="partner_customer_action" model="ir.actions.act_window">
        <field name="name">Khách hàng</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_is_customer': True, 'form_view_ref': 'ngsd_base.ngsd_res_partner_customer_view_form'}</field>
        <field name="domain">[('is_customer', '=', True)]</field>
    </record>
    <record id="partner_contact_action" model="ir.actions.act_window">
        <field name="name">Đầu mối liên hệ</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('parent_id.is_customer', '=', True)]</field>
    </record>
    <record id="partner_supplier_action" model="ir.actions.act_window">
        <field name="name">Đơn vị bán</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_is_supplier': True}</field>
        <field name="domain">[('is_supplier', '=', True), ('parent_id', '=', False)]</field>
    </record>
    <record id="partner_competitors_action" model="ir.actions.act_window">
        <field name="name">Đối thủ canh tranh</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_is_competitors': True}</field>
        <field name="domain">[('is_competitors', '=', True), ('parent_id', '=', False)]</field>
    </record>
    <record id="partner_manufacturer_action" model="ir.actions.act_window">
        <field name="name">Hãng</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_is_manufacturer': True}</field>
        <field name="domain">[('is_manufacturer', '=', True), ('parent_id', '=', False)]</field>
    </record>

</odoo>
