<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="crm_lead_view_tree" model="ir.ui.view">
            <field name="name">crm.lead.view.tree</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <list>
                    <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" help="Mở bản ghi mới"/>
                    <field name="code" string="Mã"/>
                    <field name="name"/>
                    <field name="stage_id" string="Trạng thái"/>
                    <field name="partner_id" widget="res_partner_many2one" context="{'show_short': True}" options='{"always_reload": True}'/>
                    <field name="product_names"/>
                    <field name="kickoff_planned_date"/>
                    <field name="project_end_date"/>
                    <field name="probability"/>
                    <field name="source_id"/>
                    <field name="expected_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="tender_model_id" invisible="1"/>
                    <field name="main_partner_id" invisible="1"/>
                    <field name="role_id" invisible="1"/>
                    <field name="ngsd_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="date_deadline" invisible="1"/>
                    <field name="solution_architect_uids" invisible="1"/>
                    <field name="company_type" invisible="1"/>
                    <field name="company_currency" invisible="1"/>
                    <field name="tender_model_id" optional="hide"/>
                    <field name="main_partner_id" optional="hide"/>
                    <field name="role_id" optional="hide"/>
                    <field name="date_deadline" optional="hide"/>
                    <field name="solution_architect_uids" optional="hide"/>
                </list>
            </field>
        </record>
        <record id="crm_lead_view_no_ngsd_tree" model="ir.ui.view">
            <field name="name">crm_lead_view_no_ngsd_tree</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <list>
                    <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" help="Mở bản ghi mới"/>
                    <!--                    <field name="targets_amount"/>-->
                    <field name="partner_id"/>
                    <field name="name"/>
                    <field name="total_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="last_update_note"/>
                    <field name="user_id"/>
                    <field name="perform_quarter"/>
                    <field name="perform_year"/>
                    <field name="company_type" invisible="1"/>
                    <field name="company_currency" invisible="1"/>
                </list>
            </field>
        </record>
        <record id="crm_lead_view_dmc_tree" model="ir.ui.view">
            <field name="name">crm_lead_view_no_ngsd_tree</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <list>
                    <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" help="Mở bản ghi mới"/>
                    <!--                    <field name="targets_amount"/>-->
                    <field name="partner_id"/>
                    <field name="name"/>
                    <field name="total_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="last_update_note"/>
                    <field name="user_id"/>
                    <field name="perform_quarter"/>
                    <field name="perform_year"/>
                    <field name="company_type" invisible="1"/>
                    <field name="company_currency" invisible="1"/>
                </list>
            </field>
        </record>
        <record id="crm_lead_view_ncs_tree" model="ir.ui.view">
            <field name="name">crm_lead_view_no_ngsd_tree</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <list>
                    <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" help="Mở bản ghi mới"/>
                    <!--                    <field name="targets_amount"/>-->
                    <field name="partner_id"/>
                    <field name="name"/>
                    <field name="ncs_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="gross_profit_ratio" widget="percentage"/>
                    <field name="gross_profit_value" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="last_update_note"/>
                    <field name="user_id"/>
                    <!--                    <field name="perform_quarter"/>-->
                    <!--                    <field name="perform_year"/>-->
                    <field name="company_type" invisible="1"/>
                    <field name="company_currency" invisible="1"/>
                </list>
            </field>
        </record>

        <record id="crm_lead_view_dmc_tree" model="ir.ui.view">
            <field name="name">crm_lead_view_dmc_tree</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <list>
                    <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" help="Mở bản ghi mới"/>
                    <!--                    <field name="targets_amount"/>-->
                    <field name="partner_id"/>
                    <field name="main_partner_id"/>
                    <field name="name"/>
                    <field name="total_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="last_update_note"/>
                    <field name="user_id"/>
                    <field name="perform_quarter"/>
                    <field name="perform_year"/>
                    <field name="company_type" invisible="1"/>
                    <field name="company_currency" invisible="1"/>
                </list>
            </field>
        </record>
        <record id="crm_lead_view_dmc_lead_tree" model="ir.ui.view">
            <field name="name">crm_lead_view_dmc_lead_tree</field>
            <field name="model">crm.lead</field>
            <field name="arch" type="xml">
                <list>
                    <button name="action_open_new_tab" string="" type="object" icon="fa-external-link" help="Mở bản ghi mới"/>
                    <!--                    <field name="targets_amount"/>-->
                    <field name="partner_id"/>
                    <field name="name"/>
                    <field name="total_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="last_update_note"/>
                    <field name="team_id"/>
                    <field name="perform_quarter"/>
                    <field name="perform_year"/>
                    <field name="company_type" invisible="1"/>
                    <field name="company_currency" invisible="1"/>
                </list>
            </field>
        </record>
        <record id="ngsd_crm_lead_view_kanban" model="ir.ui.view">
            <field name="name">ngsd_crm_lead_view_kanban</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
            <field name="arch" type="xml">
                <xpath expr="//kanban" position="attributes">
                    <attribute name="on_create"/>
                </xpath>
                <xpath expr="//div[hasclass('oe_kanban_bottom_right')]" position="before">
                    <div class="fa fa-external-link oe_kanban_action oe_kanban_action_button pt-1" title="Mở" modifiers="{}" options="{}" data-type="object" data-name="action_open_new_tab" type="button"/>
                </xpath>
                <xpath expr="//progressbar" position="before">
                    <field name="ngsd_revenue"/>
                    <field name="company_type"/>
                </xpath>
                <xpath expr="//progressbar" position="attributes">
                    <attribute name="sum_field">ngsd_revenue</attribute>
                </xpath>
                <xpath expr="//div[hasclass('o_kanban_record_subtitle')]/t" position="replace">
                    <t t-if="record.ngsd_revenue.raw_value">
                        <field name="ngsd_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                        <span t-if="record.recurring_revenue and record.recurring_revenue.raw_value"> + </span>
                    </t>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="en_short_name"/>
                </xpath>
                <xpath expr="//templates//span[hasclass('o_text_overflow')]" position="replace">
                    <span class="o_text_overflow" t-if="record.en_short_name.raw_value" t-esc="record.en_short_name.raw_value"/>
                </xpath>
            </field>
        </record>
        <record id="crm_lead_view_form" model="ir.ui.view">
            <field name="name">crm.lead.view.form</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_lead_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='action_set_won_rainbowman']" position="attributes">                </xpath>
                <xpath expr="//button[@name='action_set_won_rainbowman']" position="after">
                    <button name="%(ngsd_crm.crm_lead_win_action)d" string="Thắng" data-hotkey="l" title="Mark as won"
                            type="action" class="oe_highlight" context="{'default_lead_id': active_id, 'default_contract_code': contract_code, 'default_date_deadline': date_deadline}" invisible="not active or probability == 100 or type == 'lead' or company_type != 'ncs'"/>
                </xpath>
                <!--                group view-->
                <xpath expr="//field[@name='user_id']" position="replace"/>
                <xpath expr="//h2" position="attributes">                </xpath>
                <xpath expr="//h2/div[4]" position="attributes">                </xpath>
<!--                <xpath expr="//h2/div[1]/div/span[2][@class='oe_grey p-2']" position="attributes">-->
<!--                    <attribute name="attrs">{'invisible': [('company_type', '=', 'ncs')]}</attribute>-->
<!--                </xpath>-->
                <xpath expr="//label[@for='name'][1]" position="attributes">                </xpath>
                <xpath expr="//label[@for='expected_revenue']" position="attributes">                </xpath>
                <xpath expr="//label[@for='expected_revenue']" position="after">
                    <label for="expected_revenue" string="Doanh số" class="oe_edit_only" invisible="company_type != 'ncs'"/>
                </xpath>
                <xpath expr="//label[@for='name'][2]" position="attributes">                </xpath>
                <xpath expr="//label[@for='name'][2]" position="after">
                    <label for="name" string="Tên cơ hội" invisible="company_type != 'ncs'"/>
                </xpath>
                <xpath expr="//field[@name='team_id']" position="after">
                    <field name="x_ktv_ids" required="company_type == 'ncs'" invisible="company_type != 'ncs'" widget="many2many_tags"/>
                    <field name="x_consulting_team" invisible="company_type != 'ngsd'" widget="many2many_tags"/>
                    <field name="x_development_team" invisible="company_type != 'ngsd'" widget="many2many_tags"/>
                    <field name="x_region_id"/>
                </xpath>
                <xpath expr="//label[@for='email_from']" position="attributes">                </xpath>
<!--                <xpath expr="//div[@class='o_row o_row_readonly']/field[@name='email_from']/parent::div" position="attributes">-->
<!--                    <attribute name="attrs">{'invisible': [('company_type', '!=', 'ngsd')]}</attribute>-->
<!--                </xpath>-->
                <xpath expr="//label[@for='expected_revenue']" position="attributes">
                    <attribute name="for">ngsd_revenue</attribute>
                </xpath>
                <xpath expr="//field[@name='expected_revenue']" position="attributes">
                    <attribute name="name">ngsd_revenue</attribute>
                </xpath>
                <xpath expr="//field[@name='company_id']" position="attributes">
                    <attribute name="readonly">1</attribute>
                    <attribute name="force_save">1</attribute>
                </xpath>
                <xpath expr="//label[@for='phone']" position="attributes">                </xpath>
<!--                <xpath expr="//div[@class='o_row o_row_readonly']/field[@name='phone']/parent::div" position="attributes">-->
<!--                    <attribute name="attrs">{'invisible': [('company_type', '!=', 'ngsd')]}</attribute>-->
<!--                </xpath>-->

                <!--                <xpath expr="//group[@name='opportunity_partner']/field[@name='partner_id']" position="attributes">-->
                <!--                   <attribute name="attrs">{'invisible': [('company_type', '!=', 'ncs')], 'required': [('company_type', '=', 'ncs')]}</attribute>-->
                <!--                </xpath>-->

                <xpath expr="//label[@for='name']" position="before">
                    <h3 class="o_row no-gutters align-items-end" invisible="company_type != 'ngsd'">
                        <div class="col">
                            <div class="o_row">
                                <label for="contract_code"/>
                                <field name="contract_code" class="pr-2 oe_inline"/>
                            </div>
                        </div>
                    </h3>
                    <br/>
                </xpath>
                <xpath expr="//h1" position="after">
                    <field name="company_type" invisible="1"/>
                    <h5 class="o_row no-gutters align-items-end" invisible="company_type == 'dmc'">
                        <div class="col">
                            <div class="o_row">
                                <label for="code" string="Mã cơ hội" invisible="company_type != 'ncs'"/>
                                <!-- Không điền string để lấy string từ khai báo field -->
                                <label for="code" invisible="company_type == 'ncs'"/>
                                <field name="code" class="pr-2 oe_inline" readonly="company_type == 'ncs'"/>
                            </div>
                            <br/>
                            <div class="o_row" invisible="company_type != 'ncs'">
                                <label for="ncs_state"/>
                                <field name="ncs_state" class="pr-2 oe_inline"/>
                            </div>
                        </div>
                        <!--                        <div class="col">-->
                        <!--                            <div class="oe_edit_only d-flex align-items-center">-->
                        <!--                                <label for="code"/>-->
                        <!--                            </div>-->
                        <!--                            <div id="probability" class="o_row d-flex">-->
                        <!--                                <field name="code" class="oe_inline"/>-->
                        <!--                            </div>-->
                        <!--                        </div>-->
                    </h5>
                    <br/>
                </xpath>
                <!--                cột 1-->
                <xpath expr="//group[@name='lead_partner']/field[@name='partner_id']" position="attributes">
                    <attribute name="groups"/>
                    <attribute name="options">{"always_reload": True}</attribute>
                    <attribute name="context">{
                        'default_name': contact_name,
                        'default_title': title,
                        'default_street': street,
                        'default_street2': street2,
                        'default_city': city,
                        'default_state_id': state_id,
                        'default_zip': zip,
                        'default_country_id': country_id,
                        'default_function': function,
                        'default_phone': phone,
                        'default_mobile': mobile,
                        'default_email': email_from,
                        'default_user_id': user_id,
                        'default_team_id': team_id,
                        'default_website': website,
                        'show_short': True
                    }</attribute>
                </xpath>
                <xpath expr="//group[@name='opportunity_partner']/field[@name='partner_id']" position="attributes">
                    <attribute name="options">{"always_reload": True}</attribute>
                    <attribute name="context">{'res_partner_search_mode': type == 'opportunity' and 'customer' or False,
                                               'default_name': contact_name or partner_name,
                                               'default_street': street,
                                               'default_is_company': type == 'opportunity' and contact_name == False,
                                               'default_company_name': type == 'opportunity' and partner_name,
                                               'default_street2': street2,
                                               'default_city': city,
                                               'default_title': title,
                                               'default_state_id': state_id,
                                               'default_zip': zip,
                                               'default_country_id': country_id,
                                               'default_function': function,
                                               'default_phone': phone,
                                               'default_mobile': mobile,
                                               'default_email': email_from,
                                               'default_user_id': user_id,
                                               'default_team_id': team_id,
                                               'default_website': website,
                                               'show_short': True,
                                               }</attribute>
                </xpath>
                <xpath expr="//group[@name='opportunity_partner']/field[@name='partner_id']" position="before">
                    <field name="total_revenue" invisible="company_type != 'dmc'" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="ncs_revenue" placeholder="Nhập “,” nếu là số thập phân" invisible="company_type != 'ncs'" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="gross_profit_ratio" placeholder="Nhập “,” nếu là số thập phân" widget="percentage" invisible="company_type != 'ncs'" style="width:100%"/>
                    <field name="gross_profit_value" invisible="company_type != 'ncs'" style="width:100%" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                </xpath>
                <xpath expr="//group[@name='opportunity_partner']/field[@name='partner_id']" position="after">
                    <field name="legal_id" required="company_type == 'ncs'" invisible="company_type != 'ncs'"/>
                    <field name="main_partner_id" invisible="company_type != 'dmc'"/>
                    <field name="tender_model_id" invisible="company_type == 'ncs'"/>
                    <field name="company_currency" position="move"/>
                    <field name="company_currency" position="attributes">
                        <attribute name="invisible">0</attribute>
                    </field>
                    <field name="ngsd_revenue" invisible="company_type == 'ncs'" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                    <field name="expected_revenue" widget="monetary" options="{'currency_field': 'company_currency'}" invisible="company_type != 'ngsd'"/>
                    <!--                    <field name="ngsd_revenue" widget="monetary" options="{'currency_field': 'company_currency'}"/>-->
                    <field name="role_id"/>
<!--                    <field name="x_am_lead_id"/>-->
                    <field name="x_am_lead_ids" widget="many2many_tags"/>
                    <field name="user_id" context="{'default_sales_team_id': team_id}" widget="many2one_avatar_user"/>
                    <field name="solution_architect_uids"
                           widget="many2many_tags" invisible="company_type == 'ncs'"
                    />
                </xpath>
                <!--                cột 2-->
                <xpath expr="//field[@name='date_deadline']" position="before">
                    <field name="budget_approval_date" invisible="company_type == 'ncs'"/>
                    <field name="bid_opening_date" invisible="company_type == 'ncs'"/>
                    <field name="bid_closing_date" invisible="company_type == 'ncs'"/>
                    <field name="x_project_type_id" required="company_type == 'ncs'" invisible="company_type not in ['ngsd','ncs']"/>
                    <field name="to_sign_date" required="company_type == 'ncs'" invisible="company_type != 'ncs'"/>
                    <field name="to_sign_xhd" required="company_type == 'ncs'" invisible="company_type != 'ncs'"/>
                    <label for="contract_code" string="Số năm KH" invisible="company_type != 'ncs'"/>
                    <div class="o_row" invisible="company_type != 'ncs'">
                        <field name="contract_code"/>
                    </div>
                </xpath>
                <xpath expr="//field[@name='date_deadline']" position="after">
                    <field name="kickoff_planned_date" invisible="company_type == 'ncs'"/>
                    <field name="project_end_date" invisible="company_type == 'ncs'"/>
                    <field name="compete_id" invisible="company_type == 'ncs'"/>
                    <field name="last_update_note" invisible="company_type != 'dmc'"/>
                </xpath>
                <xpath expr="//page[@name='lead']" position="after">
                    <page name="support-history" string="Lịch sử chăm sóc" invisible="company_type == 'ncs'">
                        <field name="x_support_history_ids" readonly="company_type == 'ncs'">
                            <list editable="bottom">
                                <field name="x_date"/>
                                <field name="technical_field_27310" widget="many2many_tags" invisible="1"/>
                                <field name="x_partner_id" context="{'form_view_ref': 'ngsd_base.ngsd_res_partner_only_create_child_partner_form_inherit','default_company_type':'person','default_technical_field_27310':technical_field_27310, 'default_parent_id': partner_id}" required="1" domain="['|',('en_internal','=',True),('id','child_of',technical_field_27310)]"/>
                                <field name="partner_id" invisible="1"/>
                                <field name="x_note"/>
                            </list>
                        </field>
                    </page>
                    <page name="process-history" string="Mô tả chi tiết tiến độ" invisible="company_type != 'ncs'">
                        <field name="x_process_history_ids" readonly="company_type != 'ncs'">
                            <list editable="bottom">
                                <field name="x_date"/>
                                <field name="x_note"/>
                            </list>
                        </field>
                    </page>
                </xpath>
                <xpath expr="//notebook" position="attributes">                </xpath>
                <!--                List-->
                <xpath expr="//group" position="after">
                    <group string="Thông tin sản phẩm" invisible="company_type == 'ncs'">
                        <field name="line_ids" nolabel="1">
                            <list editable="bottom">
                                <field name="company_type" invisible="1"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="type_id"/>
                                <field name="description" column_invisible="parent.company_type == 'ngsd'"/>
                                <field name="categ_id" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="product_name" column_invisible="parent.company_type != 'ngsd'" required="parent.company_type == 'ngsd'"/>
                                <field name="supplier_id" domain="[('is_supplier','=',True)]" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}" context="{'default_activity_user_ids':[(6,0,[parent.user_id])],'default_is_supplier': True}" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="partner_id" domain="[('is_manufacturer','=',True)]" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}" context="{'default_activity_user_ids':[(6,0,[parent.user_id])],'default_is_manufacturer': True}"/>
                                <field name="ngsd_revenue" widget="monetary" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="ngsd_revenue_taxed" widget="monetary" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="estimated_value" widget="monetary" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="total_revenue" widget="monetary" column_invisible="parent.company_type == 'ngsd'"/>
                                <field name="note" string="Ghi chú"/>
                            </list>
                        </field>
                    </group>
                    <!--                    <group invisible="company_type == 'ngsd'">-->
                    <!--                        <field name="file_name" invisible="1"/>-->
                    <!--                        <field name="data_attachment" filename="file_name"/>-->
                    <!--                    </group>-->
                    <!--                    <field name="data_pdf_preview" widget="pdf_viewer" nolabel="1" attrs="{'invisible': ['|', ('file_name', '=', False),('company_type', '=', 'ngsd')]}"/>-->
                    <group invisible="company_type in ['ngsd', 'ncs']">
                        <label for="x_attach_file" string="Tệp đính kèm"/>
                        <div name="ir_attachment">
                            <field name="x_attach_file"
                                   widget="many2many_binary"
                                   string="Đính kèm file"
                                   nolabel="1"
                            />
                        </div>
                    </group>
                    <group string="Cập nhật tình hình dự án" invisible="company_type != 'dmc'">
                        <field name="x_support_history_ids_no_ngsd" readonly="company_type != 'dmc'" nolabel="1">
                            <list editable="bottom">
                                <field name="x_date"/>
                                <field name="technical_field_27310" widget="many2many_tags" invisible="1"/>
                                <field name="x_partner_id" context="{'form_view_ref': 'ngsd_base.ngsd_res_partner_technical_field_27310_form','default_company_type':'contact','default_technical_field_27310':technical_field_27310}" domain="['|',('en_internal','=',True),('id','child_of',technical_field_27310)]"/>
                                <field name="partner_id" invisible="1"/>
                                <field name="x_note"/>
                            </list>
                        </field>
                    </group>
                    <group string="Đầu mối liên lạc" invisible="company_type == 'ncs'">
                        <field name="contact_ids" nolabel="1">
                            <list editable="bottom">
                                <field name="partner_id" context="{'default_parent_id': parent.partner_id}" domain="[('parent_id', '!=', False), ('parent_id', '=', parent.partner_id)]"/>
                                <field name="role_id" column_invisible="parent.company_type != 'ngsd'" required="parent.company_type == 'ngsd'"/>
                                <field name="support_state_id" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="note"/>
                            </list>
                        </field>
                    </group>
                    <!--                    <group string="Người liên hệ" invisible="company_type != 'ncs'">-->
                    <!--                        <field name="contact_ids" nolabel="1">-->
                    <!--                            <list editable="bottom">-->
                    <!--                                <field name="partner_id" context="{'default_parent_id': parent.partner_id}" domain="[('parent_id', '!=', False), ('parent_id', '=', parent.partner_id)]" string="Người liên hệ "/>-->
                    <!--                                <field name="role_id" attrs="{'column_invisible': [('parent.company_type', '!=', 'ngsd')], 'required': [('parent.company_type', '=', 'ngsd')]}"/>-->
                    <!--                                <field name="support_state_id" column_invisible="parent.company_type != 'ngsd'"/>-->
                    <!--                                <field name="note"/>-->
                    <!--                            </list>-->
                    <!--                        </field>-->
                    <!--                    </group>-->
                    <group string="Đối thủ" invisible="company_type == 'ncs'">
                        <field name="opponent_ids" nolabel="1">
                            <list editable="bottom">
                                <field name="partner_id" domain="[('is_competitors','=',True)]" options="{'no_open':True,'no_create':True,'no_quick_create':True,'no_create_edit':True}" context="{'default_is_competitors': True}"/>
                                <field name="solution" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="price" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="support_pid" context="{'default_parent_id': partner_id}" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="support_state_id" column_invisible="parent.company_type != 'ngsd'"/>
                                <field name="note"/>
                            </list>
                        </field>
                    </group>
                </xpath>
                <xpath expr="//page[@name='lead']" position="attributes">                </xpath>
                <page name="internal_notes" position="before">
                    <page string="Thông tin kế toán">
                        <group string="Kế hoạch doanh thu xuất hoá đơn">
                            <field name="invoice_percent_leftover" invisible="1"/>
                            <field name="x_lead_invoice" context="{'default_percent':invoice_percent_leftover}" nolabel="1" colspan="2">
                                <list editable="bottom">
                                    <field name="date"/>
                                    <field name="percent" widget="percentage"/>
                                    <field name="amount" widget="monetary"/>
                                    <field name="note"/>
                                    <field name="currency_id" invisible="1"/>
                                </list>
                            </field>
                        </group>
                        <group string="Kế hoạch dòng tiền">
                            <field name="payment_percent_leftover" invisible="1"/>
                            <field name="x_lead_payment" context="{'default_percent':payment_percent_leftover}" nolabel="1" colspan="2">
                                <list editable="bottom">
                                    <field name="date"/>
                                    <field name="percent" widget="percentage"/>
                                    <field name="amount" widget="monetary"/>
                                    <field name="note"/>
                                    <field name="currency_id" invisible="1"/>
                                </list>
                            </field>
                        </group>
                    </page>
                </page>
                <field name="expected_revenue" position="after">
                    <field name="x_expected_ratio" widget="percentage" invisible="company_type != 'ngsd'"/>
                    <field name="x_expected_margin" widget="monetary" options="{'currency_field': 'company_currency'}" invisible="company_type != 'ngsd'"/>
                </field>
                <xpath expr="//page[@name='lead']//group" position="before">
                    <group string="Kế hoạch">
                        <group>
                            <field name="x_internal_plan"/>
                            <field name="x_into_plan"/>
                            <field name="x_doing_plan"/>
                        </group>
                        <group>
                            <field name="x_revenue_plan"/>
                            <field name="x_detail_plan"/>
                        </group>
                    </group>
                </xpath>
                <xpath expr="//group[@name='opportunity_partner']/field[@name='partner_id']" position="after">
                    <field name="en_short_name"/>
                </xpath>
                <xpath expr="//group[@name='lead_partner']/field[@name='partner_id']" position="after">
                    <field name="en_short_name"/>
                </xpath>
                <xpath expr="//field[@name='lost_reason']" position="attributes">
                    <attribute name="name">lost_reason_text</attribute>
                </xpath>

            </field>
        </record>

        <record id="quote_crm_lead_view_form" model="ir.ui.view">
            <field name="inherit_id" ref="crm.crm_lead_view_form"/>
            <field name="priority">100000</field>
            <field name="groups_id" eval="[(4,ref('ngsd_base.group_en_use_quote'))]"/>
            <field name="arch" type="xml">
                <button name="action_sale_quotations_new" position="replace">
                    <button string="Tạo hợp đồng" name="create_x_contract" type="object" class="oe_highlight" data-hotkey="q"/>
                </button>
                <button name="action_view_sale_quotation" position="replace">
                    <button class="oe_stat_button" type="object"
                            name="to_x_contract" icon="fa-pencil-square-o" invisible="x_contract_count == 0">
                        <field name="x_contract_count" widget="statinfo" string="Hợp đồng"/>
                    </button>
                </button>
                <button name="action_view_sale_order" position="replace"/>
            </field>
        </record>

        <record id="crm_lead_view_search" model="ir.ui.view">
            <field name="name">crm.lead.view.search</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
            <field name="arch" type="xml">


                <xpath expr="//filter[@name='saleschannel']" position="after">
                    <filter string="Mô hình vào thầu"
                            name="group_tender_model_id"
                            context="{'group_by': 'tender_model_id'}"
                    />
                    <filter string="Vai trò của NGS"
                            name="group_role_id"
                            context="{'group_by': 'role_id'}"
                    />
                    <filter string="SA"
                            name="group_solution_architect_uids"
                            context="{'group_by': 'solution_architect_uids'}"
                    />
                </xpath>
                <xpath expr="//filter[@name='close_date']" position="after">
                    <filter string="Ngày ký hợp đồng" name="date_deadline" date="date_deadline"/>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="replace">
                    <field name="partner_id" operator="child_of" string="Khách hàng" filter_domain="['|', '|', '|', '|',('partner_id', 'ilike', self),('partner_name', 'ilike', self),('email_from', 'ilike', self),('contact_name', 'ilike', self),('en_short_name', 'ilike', self)]"/>
                </xpath>
            </field>
        </record>
        <record id="view_res_partner_filter" model="ir.ui.view">
            <field name="inherit_id" ref="base.view_res_partner_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="replace">
                    <field name="name" filter_domain="['|', '|', '|', ('display_name', 'ilike', self), ('ref', '=', self), ('email', 'ilike', self), ('x_short', 'ilike', self)]"/>
                </xpath>
            </field>
        </record>
        <record id="crm_lead_view_pivot" model="ir.ui.view">
            <field name="name">crm_lead_view_pivot</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_opportunity_report_view_pivot"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='prorated_revenue']" position="after">
                    <field name="ngsd_revenue" type="measure"/>
                </xpath>
            </field>
        </record>

        <record id="crm.crm_lead_opportunities_view_tree"
                model="ir.actions.act_window.view">
            <field name="view_id" ref="crm_lead_view_tree"/>
        </record>

        <record id="crm.crm_lead_action_pipeline_view_tree"
                model="ir.actions.act_window.view">
            <field name="view_id" ref="crm_lead_view_tree"/>
        </record>

        <record id="crm_stage_form" model="ir.ui.view">
            <field name="name">crm_stage_form</field>
            <field name="model">crm.stage</field>
            <field name="inherit_id" ref="crm.crm_stage_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='team_id']" position="after">
                    <field name="x_type"/>
                </xpath>
                <xpath expr="//group" position="inside">
                    <group>
                        <label for="probability"/>
                        <div class="o_row">
                            <field name="probability"/>%
                        </div>
                        <field name="x_required_field_ids" widget="many2many_tags"/>
                    </group>
                </xpath>
            </field>
        </record>

        <record id="action_crm_lead_new" model="ir.actions.server">
            <field name="name">Remind</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="binding_model_id" ref="crm.model_crm_lead"/>
            <field name="state">code</field>
            <field name="code">records.send_noti_new()</field>
        </record>


    </data>
</odoo>