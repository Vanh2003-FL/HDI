<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="x_sale_contract_tree" model="ir.ui.view">
        <field name="model">x.sale.contract</field>
        <field name="arch" type="xml">
            <list string="">
                <field name="name"/>
                <field name="en_team_id" optional="show"/>
                <field name="user_id" optional="show"/>
                <field name="en_sales_sp_id" optional="show"/>
                <field name="id" string="Mã hợp đồng" optional="show"/>
                <field name="x_contract_code"/>
                <field name="partner_id"/>
                <field name="state"/>
                <field name="x_date_start"/>
                <field name="x_date_end"/>
<!--                <field name="fixed_date_end" optional="hide"/>-->
                <field name="amount_total" optional="hide"/>
                <field name="amount_total_change" optional="hide"/>
                <field name="currency_id" invisible="1"/>
                <field name="x_period_date"/>
                <field name="date_sign" optional="show"/>
                <field name="sellerPid" optional="show"/>
            </list>
        </field>
    </record>

    <record id="sale_contract_form" model="ir.ui.view">
        <field name="name">sale_contract</field>
        <field name="model">x.sale.contract</field>
        <field name="arch" type="xml">
            <form string="">
                <header>
                    <button name="button_done" confirm="Bạn chắc chắn xác nhận hợp đồng này?" type="object" states="draft" string="Xác nhận"/>
                    <button name="button_over" confirm="Bạn chắc chắn hủy hợp đồng này?" type="object" states="draft" string="Hủy"/>
                    <button name="create_invoice" type="object" string="Tạo hóa đơn"/>
                    <button name="create_payment" type="object" string="Tạo thanh toán"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div name="button_box" class="oe_button_box">
                        <button class="oe_stat_button" type="object"
                                name="to_invoice" icon="fa-pencil-square-o" attrs="{'invisible': [('move_count', '=', 0)]}">
                            <field name="move_count" widget="statinfo" string="Hóa đơn"/>
                        </button>
                        <button class="oe_stat_button" type="object"
                                name="to_payment" icon="fa-pencil-square-o" attrs="{'invisible': [('payment_count', '=', 0)]}">
                            <field name="payment_count" widget="statinfo" string="Thanh toán"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <div class="o_row">
                                <field name="name" placeholder="Tên hợp đồng..." nolabel="1"/>
                            </div>
                        </h1>
                    </div>
                    <group string="Thông tin hợp đồng">
                        <group>
                            <field name="x_contract_code"/>
                            <field name="x_project_type_id"/>
                            <field name="sellerPid"/>
                            <field name="amount_untaxed" widget="monetary"/>
                            <field name="amount_tax" widget="monetary"/>
                            <field name="amount_total" widget="monetary"/>
                            <field name="total_contract_value" invisible="1"/>
                            <field name="amount_total_change" widget="monetary" attrs="{'invisible': [('total_contract_value', '=', 0)]}"/>
                            <field name="x_payment_method"/>
                            <field name="x_payment_state"/>
                            <field name="x_noti_date"/>
                        </group>
                        <group>
                            <field name="partner_id"/>
                            <field name="en_team_id"/>
                            <field name="user_id" domain="[('crm_team_ids', '=?', en_team_id)]"/>
                            <field name="en_sales_sp_id"/>
                            <field name="currency_id"/>
                            <field name="rate"/>
                            <field name="company_id" invisible="1"/>
                            <field name="date_sign"/>
                            <field name="x_date_start"/>
                            <field name="x_date_end"/>
                            <field name="change_x_date_end" invisible="1"/>
                        </group>
                    </group>
                    <group string="Khác">
                        <group>
<!--                            <field name="x_payment_address" context="{'form_view_ref': 'ngsd_base.ngsd_res_partner_only_create_child_partner_form_inherit','default_company_type':'person', 'default_parent_id': partner_id}"/>-->
<!--                            <field name="x_delivery_address" context="{'form_view_ref': 'ngsd_base.ngsd_res_partner_only_create_child_partner_form_inherit','default_company_type':'person', 'default_parent_id': partner_id}"/>-->
<!--                            <field name="x_bill_recipient_id" context="{'form_view_ref': 'ngsd_base.ngsd_res_partner_only_create_child_partner_form_inherit','default_company_type':'person', 'default_parent_id': partner_id}"/>-->
<!--                            <field name="x_receiver_id" context="{'form_view_ref': 'ngsd_base.ngsd_res_partner_only_create_child_partner_form_inherit','default_company_type':'person', 'default_parent_id': partner_id}"/>-->
                            <field name="x_special_term"/>
                            <field name="x_note"/>
                            <field name="lead_id" invisible="1"/>
                        </group>
                        <group>
                        </group>
                    </group>
                    <notebook>
                        <page name="product_service" string="Hàng hoá dịch vụ">
                            <field name="line_ids">
                                <list editable="bottom">
                                    <field name="product_id"/>
                                    <field name="name"/>
                                    <field name="product_uom_qty"/>
                                    <field name="price_unit"/>
                                    <field name="tax_id" widget="many2many_tags"/>
                                    <field name="discount"/>
                                    <field name="price_subtotal" widget="monetary" groups="account.group_show_line_subtotals_tax_excluded"/>
                                    <field name="price_total" widget="monetary" groups="account.group_show_line_subtotals_tax_included"/>
                                    <field name="price_tax" invisible="1"/>
                                    <field name="currency_id" invisible="1"/>
                                </list>
                                <form>
                                    <div class="oe_title">
                                        <h1>
                                            <div class="o_row">
                                                <field name="name" nolabel="1"/>
                                            </div>
                                        </h1>
                                    </div>
                                    <group>
                                        <field name="product_id"/>
                                        <field name="product_uom_qty"/>
                                        <field name="price_unit"/>
                                        <field name="tax_id" widget="many2many_tags"/>
                                        <field name="discount"/>
                                        <field name="price_subtotal" widget="monetary" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <field name="price_total" widget="monetary" groups="account.group_show_line_subtotals_tax_included"/>
                                        <field name="price_tax" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                    </group>
                                </form>
                            </field>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="total">
                                <field name="amount_untaxed" widget="monetary"/>
                                <field name="amount_tax" widget="monetary"/>
                                <field name="amount_total" widget="monetary" class="oe_subtotal_footer_separator"/>
                            </group>
                        </page>
                        <page name="sale_contract_guarantee" string="Bảo lãnh">
                            <field name="guarantee_ids">
                                <list editable="bottom">
                                    <field name="code"/>
                                    <field name="currency_id"/>
                                    <field name="name" invisible="1"/>
                                    <field name="en_guarantee_id"/>
                                    <field name="bank_id"/>
                                    <field name="amount" widget="monetary"/>
                                    <field name="date"/>
                                    <field name="date_start"/>
                                    <field name="date_end"/>
                                    <field name="date_extend"/>
                                    <field name="remind_day"/>
                                    <field name="note"/>
                                </list>
                                <form>
                                    <div class="oe_title">
                                        <h1>
                                            <div class="o_row">
                                                <field name="code" nolabel="1"/>
                                            </div>
                                        </h1>
                                    </div>
                                    <group>
                                        <field name="code"/>
                                        <field name="currency_id" widget="monetary"/>
                                        <field name="name"/>
                                        <field name="bank_id"/>
                                        <field name="amount"/>
                                        <field name="date"/>
                                        <field name="date_start"/>
                                        <field name="date_end"/>
                                        <field name="date_extend"/>
                                        <field name="remind_day"/>
                                        <field name="note"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page name="sign_info" string="Thông tin ký kết">
                            <group>
                                <group>
<!--                                    <field name="x_representative_customer_id" context="{'form_view_ref': 'ngsd_base.ngsd_res_partner_only_create_child_partner_form_inherit','default_company_type':'person', 'default_parent_id': partner_id}"/>-->
                                    <field name="x_representative_customer"/>
                                    <field name="position_customer"/>
                                    <field name="x_date_customer"/>
                                </group>
                                <group>
                                    <field name="x_representative_firm_id"/>
                                    <field name="position_firm"/>
                                    <field name="x_date_firm"/>
                                </group>
                            </group>
                        </page>
                        <page name="sale_info" string="Thông tin báo giá">
                            <group>
                                <group>
                                    <field name="order_id"/>
                                    <field name="x_money"/>
                                    <field name="x_discount"/>
                                    <field name="x_cost_discount"/>
                                </group>
                                <group>
                                    <field name="currency_id"/>
                                    <field name="x_tax"/>
                                    <field name="x_delivery_cost"/>
                                    <field name="x_total_cost"/>
                                </group>
                            </group>
                        </page>
                        <page name="annex_info" string="Phụ lục hợp đồng">
                            <field name="order_line">
                                <list editable="bottom">
                                    <field name="has_add_value" invisible="1"/>
                                    <field name="has_reduce_value" invisible="1"/>
                                    <field name="has_change_time" invisible="1"/>
                                    <field name="has_change_terms" invisible="1"/>
                                    <field name="has_other" invisible="1"/>
                                    <field name="name"/>
<!--                                    <field name="change"/>-->
                                    <field name="change_ids" widget="many2many_tags"/>
                                    <field name="contract_date" attrs="{'invisible':[('has_change_time','=', False)], 'required':[('has_change_time','=', True)]}"/>
                                    <field name="contract_value" attrs="{'invisible':[('has_add_value','=', False), ('has_reduce_value','=', False)],'required':['|', ('has_add_value','=', True), ('has_reduce_value','=', True)]}"/>
                                    <field name="description"/>
                                    <field name="attachment_ids"  widget="many2many_binary"/>
                                </list>
                                <form>
                                    <div class="oe_title">
                                        <h1>
                                            <div class="o_row">
                                                <field name="name" nolabel="1"/>
                                            </div>
                                        </h1>
                                    </div>
                                    <group>
                                        <field name="name"/>
                                        <field name="change"/>
                                        <field name="contract_date"/>
                                        <field name="contract_value"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page string="Lịch trình thanh toán">
                            <field name="x_payment_schedule_ids">
                                <list editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="name"/>
                                    <field name="x_cost" sum="x_cost"/>
                                    <field name="x_percent" widget="percentage" sum="x_percent"/>
                                    <field name="payment_term_id"/>
                                    <field name="currency_id" optional="hide"/>
                                    <field name="due_date"/>
                                    <field name="payment_date"/>
                                    <field name="required_document"/>
                                    <field name="note"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter/><field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="view_sale_contract_search" model="ir.ui.view">
        <field name="name">view_sale_contract_search</field>
        <field name="model">x.sale.contract</field>
        <field name="arch" type="xml">
            <search string="Tìm kiếm">
                <field name="name" string="Hợp đồng" filter_domain="['|', ('name', 'ilike', self), ('x_contract_code', 'ilike', self)]"/>
                <field name="user_id"/>
                <field name="partner_id"/>
                <field name="en_sales_sp_id"/>
            </search>
        </field>
    </record>

    <record id="action_sale_contract" model="ir.actions.act_window">
        <field name="name">Hợp đồng</field>
        <field name="type">ir.actions.act_window</field>
        <field name="search_view_id" ref="ngsd_crm.view_sale_contract_search"/>
        <field name="res_model">x.sale.contract</field>
        <field name="view_ids"
               eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'list', 'view_id': ref('ngsd_crm.x_sale_contract_tree')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('ngsd_crm.sale_contract_form')})]"/>
    </record>

    <record id="crm_menu_contract" model="ir.ui.menu">
        <field name="action" ref="ngsd_crm.action_sale_contract"/>
    </record>

    <menuitem
            id="crm_menu_contract"
            name="Hợp đồng"
            parent="crm.crm_menu_root"
            sequence="5"/>
</odoo>
